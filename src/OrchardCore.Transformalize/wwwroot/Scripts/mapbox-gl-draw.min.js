(function(n,t){typeof exports=="object"&&typeof module!="undefined"?module.exports=t():typeof define=="function"&&define.amd?define(t):(n=typeof globalThis!="undefined"?globalThis:n||self,n.MapboxDraw=t())})(this,function(){"use strict";function ot(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n["default"]:n}function kf(n){var i,t;return n.__esModule?n:(i=n.default,typeof i=="function"?(t=function t(){var n,r;return this instanceof t?(n=[null],n.push.apply(n,arguments),r=Function.bind.apply(i,n),new r):i.apply(this,arguments)},t.prototype=i.prototype):t={},Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}),t)}function pr(n){var i=0,t;switch(n.type){case"Polygon":return wr(n.coordinates);case"MultiPolygon":for(t=0;t<n.coordinates.length;t++)i+=wr(n.coordinates[t]);return i;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(t=0;t<n.geometries.length;t++)i+=pr(n.geometries[t]);return i}}function wr(n){var i=0,t;if(n&&n.length>0)for(i+=Math.abs(ki(n[0])),t=1;t<n.length;t++)i-=Math.abs(ki(n[t]));return i}function ki(n){var o,s,h,r,u,f,t,e=0,i=n.length;if(i>2){for(t=0;t<i;t++)t===i-2?(r=i-2,u=i-1,f=0):t===i-1?(r=i-1,u=0,f=1):(r=t,u=t+1,f=t+2),o=n[r],s=n[u],h=n[f],e+=(di(h[0])-di(o[0]))*Math.sin(di(s[1]));e=e*bi.RADIUS*bi.RADIUS/2}return e}function di(n){return n*Math.PI/180}function gf(t,i){var r=tu[t.geometry.type]-tu[i.geometry.type];return r===0&&t.geometry.type===n.POLYGON?t.area-i.area:r}function iu(t){return t.map(function(t){return t.geometry.type===n.POLYGON&&(t.area=wi.geometry({type:n.FEATURE,property:{},geometry:t.geometry})),t}).sort(gf).map(function(n){return delete n.area,n})}function ru(n,t){return t===void 0&&(t=0),[[n.point.x-t,n.point.y-t],[n.point.x+t,n.point.y+t]]}function b(n){if(this._items={},this._nums={},this._length=n?n.length:0,n)for(var t=0,i=n.length;t<i;t++)(this.add(n[t]),n[t]!==undefined)&&(typeof n[t]=="string"?this._items[n[t]]=t:this._nums[n[t]]=t)}function ne(n,t,i){return fu(n,t,i,i.options.clickBuffer)}function te(n,t,i){return fu(n,t,i,i.options.touchBuffer)}function fu(n,t,i,r){var f,u;if(i.map===null)return[];f=n?ru(n,r):t;u={};i.options.styles&&(u.layers=i.options.styles.map(function(n){return n.id}).filter(function(n){return i.map.getLayer(n)!=null}));var s=i.map.queryRenderedFeatures(f,u).filter(function(n){return uu.indexOf(n.properties.meta)!==-1}),e=new b,o=[];return s.forEach(function(n){var t=n.properties.id;e.has(t)||(e.add(t),o.push(n))}),iu(o)}function dt(n,t){var i=ft.click(n,null,t),r={mouse:e.NONE};return i[0]&&(r.mouse=i[0].properties.active===o.ACTIVE?e.MOVE:e.POINTER,r.feature=i[0].properties.meta),t.events.currentModeName().indexOf("draw")!==-1&&(r.mouse=e.ADD),t.ui.queueMapClasses(r),t.ui.updateMapClasses(),i[0]}function nr(n,t){var i=n.x-t.x,r=n.y-t.y;return Math.sqrt(i*i+r*r)}function tr(n,t,i){var r;i===void 0&&(i={});var u=i.fineTolerance!=null?i.fineTolerance:ie,f=i.grossTolerance!=null?i.grossTolerance:re,e=i.interval!=null?i.interval:ue;return n.point=n.point||t.point,n.time=n.time||t.time,r=nr(n.point,t.point),r<u||r<f&&t.time-n.time<e}function ir(n,t,i){var r,u,f;return i===void 0&&(i={}),r=i.tolerance!=null?i.tolerance:eu,u=i.interval!=null?i.interval:ou,n.point=n.point||t.point,n.time=n.time||t.time,f=nr(n.point,t.point),f<r&&t.time-n.time<u}function t(n){this.map=n.map;this.drawConfig=JSON.parse(JSON.stringify(n.options||{}));this._ctx=n}function oe(n){var i=Object.keys(n);return function(r,u){function o(n){return function(t){return e[n](f,t)}}u===void 0&&(u={});var f={},e=i.reduce(function(t,i){return t[i]=n[i],t},new t(r));return{start:function(){var t=this;f=e.onSetup(u);su.forEach(function(i){var r=fr[i],u=function(){return!1};n[r]&&(u=function(){return!0});t.on(i,u,o(r))})},stop:function(){e.onStop(f)},trash:function(){e.onTrash(f)},combineFeatures:function(){e.onCombineFeatures(f)},uncombineFeatures:function(){e.onUncombineFeatures(f)},render:function(n,t){e.toDisplayFeatures(f,n,t)}}}}function se(n){function o(t,i,f){var e,o;if(f===void 0&&(f={}),r.stop(),e=l[t],e===undefined)throw new Error(t+" is not valid");u=t;o=e(n,i);r=pi(o,n);f.silent||n.map.fire(p.MODE_CHANGE,{mode:t});n.store.setDirty();n.store.render()}function a(t){var i=!1;Object.keys(t).forEach(function(n){if(f[n]===undefined)throw new Error("Invalid action type");f[n]!==t[n]&&(i=!0);f[n]=t[n]});i&&n.map.fire(p.ACTIONABLE,{actions:f})}var l=Object.keys(n.options.modes).reduce(function(t,i){return t[i]=oe(n.options.modes[i]),t},{}),s={},h={},t={},u=null,r=null,c,f;return t.drag=function(t,i){i({point:t.point,time:(new Date).getTime()})?(n.ui.queueMapClasses({mouse:e.DRAG}),r.drag(t)):t.originalEvent.stopPropagation()},t.mousedrag=function(n){t.drag(n,function(n){return!tr(s,n)})},t.touchdrag=function(n){t.drag(n,function(n){return!ir(h,n)})},t.mousemove=function(i){var f=i.originalEvent.buttons!==undefined?i.originalEvent.buttons:i.originalEvent.which,u;if(f===1)return t.mousedrag(i);u=dt(i,n);i.featureTarget=u;r.mousemove(i)},t.mousedown=function(t){s={time:(new Date).getTime(),point:t.point};var i=dt(t,n);t.featureTarget=i;r.mousedown(t)},t.mouseup=function(t){var i=dt(t,n);t.featureTarget=i;tr(s,{point:t.point,time:(new Date).getTime()})?r.click(t):r.mouseup(t)},t.mouseout=function(n){r.mouseout(n)},t.touchstart=function(t){if(n.options.touchEnabled){h={time:(new Date).getTime(),point:t.point};var i=ft.touch(t,null,n)[0];t.featureTarget=i;r.touchstart(t)}},t.touchmove=function(i){if(n.options.touchEnabled)return r.touchmove(i),t.touchdrag(i)},t.touchend=function(t){if(t.originalEvent.preventDefault(),n.options.touchEnabled){var i=ft.touch(t,null,n)[0];t.featureTarget=i;ir(h,{time:(new Date).getTime(),point:t.point})?r.tap(t):r.touchend(t)}},c=function(n){return!(n===8||n===46||n>=48&&n<=57)},t.keydown=function(t){var u=(t.srcElement||t.target).classList.contains("mapboxgl-canvas");u&&((t.keyCode===8||t.keyCode===46)&&n.options.controls.trash?(t.preventDefault(),r.trash()):c(t.keyCode)?r.keydown(t):t.keyCode===49&&n.options.controls.point?o(i.DRAW_POINT):t.keyCode===50&&n.options.controls.line_string?o(i.DRAW_LINE_STRING):t.keyCode===51&&n.options.controls.polygon&&o(i.DRAW_POLYGON))},t.keyup=function(n){c(n.keyCode)&&r.keyup(n)},t.zoomend=function(){n.store.changeZoom()},t.data=function(t){if(t.dataType==="style"){var r=n.setup,u=n.map,f=n.options,i=n.store,e=f.styles.some(function(n){return u.getLayer(n.id)});e||(r.addLayers(),i.setDirty(),i.render())}},f={trash:!1,combineFeatures:!1,uncombineFeatures:!1},{start:function(){u=n.options.defaultMode;r=pi(l[u](n),n)},changeMode:o,actionable:a,currentModeName:function(){return u},currentModeRender:function(n,t){return r.render(n,t)},fire:function(n,i){t[n]&&t[n](i)},addEventListeners:function(){n.map.on("mousemove",t.mousemove);n.map.on("mousedown",t.mousedown);n.map.on("mouseup",t.mouseup);n.map.on("data",t.data);n.map.on("touchmove",t.touchmove);n.map.on("touchstart",t.touchstart);n.map.on("touchend",t.touchend);n.container.addEventListener("mouseout",t.mouseout);n.options.keybindings&&(n.container.addEventListener("keydown",t.keydown),n.container.addEventListener("keyup",t.keyup))},removeEventListeners:function(){n.map.off("mousemove",t.mousemove);n.map.off("mousedown",t.mousedown);n.map.off("mouseup",t.mouseup);n.map.off("data",t.data);n.map.off("touchmove",t.touchmove);n.map.off("touchstart",t.touchstart);n.map.off("touchend",t.touchend);n.container.removeEventListener("mouseout",t.mouseout);n.options.keybindings&&(n.container.removeEventListener("keydown",t.keydown),n.container.removeEventListener("keyup",t.keyup))},trash:function(n){r.trash(n)},combineFeatures:function(){r.combineFeatures()},uncombineFeatures:function(){r.uncombineFeatures()},getMode:function(){return u}}}function lt(n){return[].concat(n).filter(function(n){return n!==undefined})}function he(){function o(n,i){var r=t.get(n),f=r.internal(u);t.ctx.events.currentModeRender(f,function(n){t.sources[i].push(n)})}function h(){t.isDirty=!1;t.clearChangedIds()}var t=this,c=t.ctx.map&&t.ctx.map.getSource(w.HOT)!==undefined,u,i,r,f,e,s;if(!c)return h();u=t.ctx.events.currentModeName();t.ctx.ui.queueMapClasses({mode:u});i=[];r=[];t.isDirty?r=t.getAllIds():(i=t.getChangedIds().filter(function(n){return t.get(n)!==undefined}),r=t.sources.hot.filter(function(n){return n.properties.id&&i.indexOf(n.properties.id)===-1&&t.get(n.properties.id)!==undefined}).map(function(n){return n.properties.id}));t.sources.hot=[];f=t.sources.cold.length;t.sources.cold=t.isDirty?[]:t.sources.cold.filter(function(n){var t=n.properties.id||n.properties.parent;return i.indexOf(t)===-1});e=f!==t.sources.cold.length||r.length>0;i.forEach(function(n){return o(n,"hot")});r.forEach(function(n){return o(n,"cold")});e&&t.ctx.map.getSource(w.COLD).setData({type:n.FEATURE_COLLECTION,features:t.sources.cold});t.ctx.map.getSource(w.HOT).setData({type:n.FEATURE_COLLECTION,features:t.sources.hot});t._emitSelectionChange&&(t.ctx.map.fire(p.SELECTION_CHANGE,{features:t.getSelected().map(function(n){return n.toGeoJSON()}),points:t.getSelectedCoordinates().map(function(t){return{type:n.FEATURE,properties:{},geometry:{type:n.POINT,coordinates:t.coordinates}}})}),t._emitSelectionChange=!1);t._deletedFeaturesToEmit.length&&(s=t._deletedFeaturesToEmit.map(function(n){return n.toGeoJSON()}),t._deletedFeaturesToEmit=[],t.ctx.map.fire(p.DELETE,{features:s}));h();t.ctx.map.fire(p.RENDER,{})}function f(n){var i=this,t;this._features={};this._featureIds=new b;this._selectedFeatureIds=new b;this._selectedCoordinates=[];this._changedFeatureIds=new b;this._deletedFeaturesToEmit=[];this._emitSelectionChange=!1;this._mapInitialConfig={};this.ctx=n;this.sources={hot:[],cold:[]};this.render=function(){t||(t=requestAnimationFrame(function(){t=null;he.call(i)}))};this.isDirty=!1}function hu(n,t){var i=n._selectedCoordinates.filter(function(t){return n._selectedFeatureIds.has(t.feature_id)});n._selectedCoordinates.length===i.length||t.silent||(n._emitSelectionChange=!0);n._selectedCoordinates=i}function ce(){for(var n,t,u=arguments,r={},i=0;i<arguments.length;i++){n=u[i];for(t in n)lu.call(n,t)&&(r[t]=n[t])}return r}function le(n){function l(){o({mode:null,feature:null,mouse:null});s()}function o(n){r=ut(r,n)}function s(){var u,f,t,i;n.container&&(t=[],i=[],au.forEach(function(n){r[n]!==e[n]&&(t.push(n+"-"+e[n]),r[n]!==null&&i.push(n+"-"+r[n]))}),t.length>0&&(u=n.container.classList).remove.apply(u,t),i.length>0&&(f=n.container.classList).add.apply(f,i),e=ut(e,r))}function u(n,t){t===void 0&&(t={});var i=document.createElement("button");return i.className=y.CONTROL_BUTTON+" "+t.className,i.setAttribute("title",t.title),t.container.appendChild(i),i.addEventListener("click",function(i){i.preventDefault();i.stopPropagation();var r=i.target;if(r===f){h();t.onDeactivate();return}c(n);t.onActivate()},!0),i}function h(){f&&(f.classList.remove(y.ACTIVE_BUTTON),f=null)}function c(n){h();var i=t[n];i&&i&&n!=="trash"&&(i.classList.add(y.ACTIVE_BUTTON),f=i)}function v(){var f=n.options.controls,r=document.createElement("div");return(r.className=y.CONTROL_GROUP+" "+y.CONTROL_BASE,!f)?r:(f[a.LINE]&&(t[a.LINE]=u(a.LINE,{container:r,className:y.CONTROL_BUTTON_LINE,title:"LineString tool "+(n.options.keybindings?"(l)":""),onActivate:function(){return n.events.changeMode(i.DRAW_LINE_STRING)},onDeactivate:function(){return n.events.trash()}})),f[a.POLYGON]&&(t[a.POLYGON]=u(a.POLYGON,{container:r,className:y.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(n.options.keybindings?"(p)":""),onActivate:function(){return n.events.changeMode(i.DRAW_POLYGON)},onDeactivate:function(){return n.events.trash()}})),f[a.POINT]&&(t[a.POINT]=u(a.POINT,{container:r,className:y.CONTROL_BUTTON_POINT,title:"Marker tool "+(n.options.keybindings?"(m)":""),onActivate:function(){return n.events.changeMode(i.DRAW_POINT)},onDeactivate:function(){return n.events.trash()}})),f.trash&&(t.trash=u("trash",{container:r,className:y.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){n.events.trash()}})),f.combine_features&&(t.combine_features=u("combineFeatures",{container:r,className:y.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){n.events.combineFeatures()}})),f.uncombine_features&&(t.uncombine_features=u("uncombineFeatures",{container:r,className:y.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){n.events.uncombineFeatures()}})),r)}function p(){Object.keys(t).forEach(function(n){var i=t[n];i.parentNode&&i.parentNode.removeChild(i);delete t[n]})}var t={},f=null,e={mode:null,feature:null,mouse:null},r={mode:null,feature:null,mouse:null};return{setActiveButton:c,queueMapClasses:o,updateMapClasses:s,clearMapClasses:l,addButtons:v,removeButtons:p}}function ae(t){var r=null,u=null,i={onRemove:function(){return t.map.off("load",i.connect),clearInterval(u),i.removeLayers(),t.store.restoreMapConfig(),t.ui.removeButtons(),t.events.removeEventListeners(),t.ui.clearMapClasses(),t.boxZoomInitial&&t.map.boxZoom.enable(),t.map=null,t.container=null,t.store=null,r&&r.parentNode&&r.parentNode.removeChild(r),r=null,this},connect:function(){t.map.off("load",i.connect);clearInterval(u);i.addLayers();t.store.storeMapConfig();t.events.addEventListeners()},onAdd:function(n){var e=n.fire;if(n.fire=function(t,i){var r=arguments;return e.length===1&&arguments.length!==1&&(r=[ut({},{type:t},i)]),e.apply(n,r)},t.map=n,t.events=se(t),t.ui=le(t),t.container=n.getContainer(),t.store=new f(t),r=t.ui.addButtons(),t.options.boxSelect&&(t.boxZoomInitial=n.boxZoom.isEnabled(),n.boxZoom.disable(),n.dragPan.disable(),n.dragPan.enable()),n.loaded())i.connect();else{n.on("load",i.connect);u=setInterval(function(){n.loaded()&&i.connect()},16)}return t.events.start(),r},addLayers:function(){t.map.addSource(w.COLD,{data:{type:n.FEATURE_COLLECTION,features:[]},type:"geojson"});t.map.addSource(w.HOT,{data:{type:n.FEATURE_COLLECTION,features:[]},type:"geojson"});t.options.styles.forEach(function(n){t.map.addLayer(n)});t.store.setDirty(!0);t.store.render()},removeLayers:function(){t.options.styles.forEach(function(n){t.map.getLayer(n.id)&&t.map.removeLayer(n.id)});t.map.getSource(w.COLD)&&t.map.removeSource(w.COLD);t.map.getSource(w.HOT)&&t.map.removeSource(w.HOT)}};return t.setup=i,i}function ti(n){return function(t){var i=t.featureTarget;return i?i.properties?i.properties.meta===n:!1:!1}}function vu(n){return n.originalEvent?n.originalEvent.shiftKey?n.originalEvent.button===0:!1:!1}function et(n){return n.featureTarget?n.featureTarget.properties?n.featureTarget.properties.active===o.ACTIVE&&n.featureTarget.properties.meta===s.FEATURE:!1:!1}function or(n){return n.featureTarget?n.featureTarget.properties?n.featureTarget.properties.active===o.INACTIVE&&n.featureTarget.properties.meta===s.FEATURE:!1:!1}function ii(n){return n.featureTarget===undefined}function sr(n){return n.featureTarget?n.featureTarget.properties?n.featureTarget.properties.meta===s.FEATURE:!1:!1}function at(n){var t=n.featureTarget;return t?t.properties?t.properties.meta===s.VERTEX:!1:!1}function ri(n){return n.originalEvent?n.originalEvent.shiftKey===!0:!1}function ui(n){return n.keyCode===27}function fi(n){return n.keyCode===13}function ve(){return!0}function st(n,t){this.x=n;this.y=t}function hr(n,t){var i=t.getBoundingClientRect();return new wu(n.clientX-i.left-(t.clientLeft||0),n.clientY-i.top-(t.clientTop||0))}function ht(t,i,r,u){return{type:n.FEATURE,properties:{meta:s.VERTEX,parent:t,coord_path:r,active:u?o.ACTIVE:o.INACTIVE},geometry:{type:n.POINT,coordinates:i}}}function bu(t,i,r){var f=i.geometry.coordinates,e=r.geometry.coordinates,u;return f[1]>kt||f[1]<bt||e[1]>kt||e[1]<bt?null:(u={lng:(f[0]+e[0])/2,lat:(f[1]+e[1])/2},{type:n.FEATURE,properties:{meta:s.MIDPOINT,parent:t,lng:u.lng,lat:u.lat,coord_path:r.properties.coord_path},geometry:{type:n.POINT,coordinates:[u.lng,u.lat]}})}function ei(t,i,r){function h(n,t){var f="",r=null;n.forEach(function(n,e){var a=t!==undefined&&t!==null?t+"."+e:String(e),s=ht(o,n,a,c(a)),h,l;i.midpoints&&r&&(h=bu(o,r,s),h&&u.push(h));r=s;l=JSON.stringify(n);f!==l&&u.push(s);e===0&&(f=l)})}function c(n){return i.selectedPaths?i.selectedPaths.indexOf(n)!==-1:!1}function l(){var r=f.replace(n.MULTI_PREFIX,"");e.forEach(function(f,e){var o={type:n.FEATURE,properties:t.properties,geometry:{type:r,coordinates:f}};u=u.concat(ei(o,i,e))})}i===void 0&&(i={});r===void 0&&(r=null);var s=t.geometry,f=s.type,e=s.coordinates,o=t.properties&&t.properties.id,u=[];return f===n.POINT?u.push(ht(o,e,r,c(r))):f===n.POLYGON?e.forEach(function(n,t){h(n,r!==null?r+"."+t:String(t))}):f===n.LINE_STRING?h(e,r):f.indexOf(n.MULTI_PREFIX)===0&&l(),u}function pe(n){if(!n||!n.type)return null;var t=ye[n.type];return t?t==="geometry"?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:n}]}:t==="feature"?{type:"FeatureCollection",features:[n]}:t==="featurecollection"?n:void 0:null}function si(n){switch(n&&n.type||null){case"FeatureCollection":return n.features=n.features.reduce(function(n,t){return n.concat(si(t))},[]),n;case"Feature":return n.geometry?si(n.geometry).map(function(t){var i={type:"Feature",properties:JSON.parse(JSON.stringify(n.properties)),geometry:t};return void 0!==n.id&&(i.id=n.id),i}):[n];case"MultiPoint":return n.coordinates.map(function(n){return{type:"Point",coordinates:n}});case"MultiPolygon":return n.coordinates.map(function(n){return{type:"Polygon",coordinates:n}});case"MultiLineString":return n.coordinates.map(function(n){return{type:"LineString",coordinates:n}});case"GeometryCollection":return n.geometries.map(si).reduce(function(n,t){return n.concat(t)},[]);case"Point":case"Polygon":case"LineString":return[n]}}function k(n){this.value=n}function nf(n,t,i){var u=[],r=[],f=!0;return function e(n){function l(){if(typeof o.node=="object"&&o.node!==null){o.keys&&o.node_===o.node||(o.keys=vt(o.node));o.isLeaf=o.keys.length==0;for(var t=0;t<r.length;t++)if(r[t].node_===n){o.circular=r[t];break}}else o.isLeaf=!0,o.keys=null;o.notLeaf=!o.isLeaf;o.notRoot=!o.isRoot}var a=i?tf(n):n,s={},h=!0,o={node:a,node_:n,path:[].concat(u),parent:r[r.length-1],parents:r,key:u.slice(-1)[0],isRoot:u.length===0,level:u.length,circular:null,update:function(n,t){o.isRoot||(o.parent.node[o.key]=n);o.node=n;t&&(h=!1)},"delete":function(n){delete o.parent.node[o.key];n&&(h=!1)},remove:function(n){cr(o.parent.node)?o.parent.node.splice(o.key,1):delete o.parent.node[o.key];n&&(h=!1)},keys:null,before:function(n){s.before=n},after:function(n){s.after=n},pre:function(n){s.pre=n},post:function(n){s.post=n},stop:function(){f=!1},block:function(){h=!1}},c;return f?(l(),c=t.call(o,o.node),c!==undefined&&o.update&&o.update(c),s.before&&s.before.call(o,o.node),!h)?o:(typeof o.node!="object"||o.node===null||o.circular||(r.push(o),l(),yt(o.keys,function(n,t){u.push(n);s.pre&&s.pre.call(o,o.node[n],n);var r=e(o.node[n]);i&&ci.call(o.node,n)&&(o.node[n]=r.node);r.isLast=t==o.keys.length-1;r.isFirst=t==0;s.post&&s.post.call(o,r);u.pop()}),r.pop()),s.after&&s.after.call(o,o.node),o):o}(n).node}function tf(n){var t,r,i;return typeof n=="object"&&n!==null?(cr(n)?t=[]:io(n)?t=new Date(n.getTime?n.getTime():n):ro(n)?t=new RegExp(n):uo(n)?t={message:n.message}:fo(n)?t=new Boolean(n):eo(n)?t=new Number(n):oo(n)?t=new String(n):Object.create&&Object.getPrototypeOf?t=Object.create(Object.getPrototypeOf(n)):n.constructor===Object?t={}:(r=n.constructor&&n.constructor.prototype||n.__proto__||{},i=function(){},i.prototype=r,t=new i),yt(vt(n),function(i){t[i]=n[i]}),t):n}function ct(n){return Object.prototype.toString.call(n)}function io(n){return ct(n)==="[object Date]"}function ro(n){return ct(n)==="[object RegExp]"}function uo(n){return ct(n)==="[object Error]"}function fo(n){return ct(n)==="[object Boolean]"}function eo(n){return ct(n)==="[object Number]"}function oo(n){return ct(n)==="[object String]"}function l(n){if(!(this instanceof l))return new l(n);this._bbox=n||[Infinity,Infinity,-Infinity,-Infinity];this._valid=!!n}function lr(n){for(var i=ao(),r=co(n),t=0;t<r.length;t++)i.include(r[t]);return i}function ar(n,t){var r=li,u=ai,f=li,e=ai,o=sf,s=ef,i;return n.forEach(function(n){var t=po(n),i=t[1],h=t[3],c=t[0],l=t[2];i>r&&(r=i);h<u&&(u=h);h>f&&(f=h);i<e&&(e=i);c<o&&(o=c);l>s&&(s=l)}),i=t,r+i.lat>ff&&(i.lat=ff-r),f+i.lat>ai&&(i.lat=ai-f),u+i.lat<uf&&(i.lat=uf-u),e+i.lat<li&&(i.lat=li-e),o+i.lng<=ef&&(i.lng+=Math.ceil(Math.abs(i.lng)/360)*360),s+i.lng>=sf&&(i.lng-=Math.ceil(Math.abs(i.lng)/360)*360),i}function vr(t,i){var r=ar(t.map(function(n){return n.toGeoJSON()}),i);t.forEach(function(t){var u=t.getCoordinates(),f=function(n){var t={lng:n[0]+r.lng,lat:n[1]+r.lat};return[t.lng,t.lat]},e=function(n){return n.map(function(n){return f(n)})},o=function(n){return n.map(function(n){return e(n)})},i;t.type===n.POINT?i=f(u):t.type===n.LINE_STRING||t.type===n.MULTI_POINT?i=u.map(f):t.type===n.POLYGON||t.type===n.MULTI_LINE_STRING?i=u.map(e):t.type===n.MULTI_POLYGON&&(i=u.map(o));t.incomingCoords(i)})}function vi(n,t){return n.lngLat?n.lngLat.lng===t[0]&&n.lngLat.lat===t[1]:!1}function af(n,t){return n.map(function(n){return n.source?n:ut(n,{id:n.id+"."+t,source:t==="hot"?w.HOT:w.COLD})})}function go(n){n===void 0&&(n={});var t=ut(n);return n.controls||(t.controls={}),t.controls=n.displayControlsDefault===!1?ut(ko,n.controls):ut(bo,n.controls),t=ut(wo,t),t.styles=af(t.styles,"cold").concat(af(t.styles,"hot")),t}function yf(n,t){return n.length!==t.length?!1:JSON.stringify(n.map(function(n){return n}).sort())===JSON.stringify(t.map(function(n){return n}).sort())}function ns(t,r){return r.modes=i,r.getFeatureIdsAt=function(n){var i=ft.click({point:n},null,t);return i.map(function(n){return n.properties.id})},r.getSelectedIds=function(){return t.store.getSelectedIds()},r.getSelected=function(){return{type:n.FEATURE_COLLECTION,features:t.store.getSelectedIds().map(function(n){return t.store.get(n)}).map(function(n){return n.toGeoJSON()})}},r.getSelectedPoints=function(){return{type:n.FEATURE_COLLECTION,features:t.store.getSelectedCoordinates().map(function(t){return{type:n.FEATURE,properties:{},geometry:{type:n.POINT,coordinates:t.coordinates}}})}},r.set=function(i){if(i.type===undefined||i.type!==n.FEATURE_COLLECTION||!Array.isArray(i.features))throw new Error("Invalid FeatureCollection");var e=t.store.createRenderBatch(),u=t.store.getAllIds().slice(),f=r.add(i),o=new b(f);return u=u.filter(function(n){return!o.has(n)}),u.length&&r.delete(u),e(),f},r.add=function(n){var i=JSON.parse(JSON.stringify(du(n))),r=i.features.map(function(n){var r,u,i;if(n.id=n.id||ur(),n.geometry===null)throw new Error("Invalid geometry: null");if(t.store.get(n.id)===undefined||t.store.get(n.id).type!==n.geometry.type){if(r=pf[n.geometry.type],r===undefined)throw new Error("Invalid geometry type: "+n.geometry.type+".");u=new r(t,n);t.store.add(u)}else i=t.store.get(n.id),i.properties=n.properties,yr(i.properties,n.properties)||t.store.featureChanged(i.id),yr(i.getCoordinates(),n.geometry.coordinates)||i.incomingCoords(n.geometry.coordinates);return n.id});return t.store.render(),r},r.get=function(n){var i=t.store.get(n);if(i)return i.toGeoJSON()},r.getAll=function(){return{type:n.FEATURE_COLLECTION,features:t.store.getAll().map(function(n){return n.toGeoJSON()})}},r.delete=function(n){return t.store.delete(n,{silent:!0}),r.getMode()!==i.DIRECT_SELECT||t.store.getSelectedIds().length?t.store.render():t.events.changeMode(i.SIMPLE_SELECT,undefined,{silent:!0}),r},r.deleteAll=function(){return t.store.delete(t.store.getAllIds(),{silent:!0}),r.getMode()===i.DIRECT_SELECT?t.events.changeMode(i.SIMPLE_SELECT,undefined,{silent:!0}):t.store.render(),r},r.changeMode=function(n,u){return(u===void 0&&(u={}),n===i.SIMPLE_SELECT&&r.getMode()===i.SIMPLE_SELECT)?yf(u.featureIds||[],t.store.getSelectedIds())?r:(t.store.setSelected(u.featureIds,{silent:!0}),t.store.render(),r):n===i.DIRECT_SELECT&&r.getMode()===i.DIRECT_SELECT&&u.featureId===t.store.getSelectedIds()[0]?r:(t.events.changeMode(n,u,{silent:!0}),r)},r.getMode=function(){return t.events.getMode()},r.trash=function(){return t.events.trash({silent:!0}),r},r.combineFeatures=function(){return t.events.combineFeatures({silent:!0}),r},r.uncombineFeatures=function(){return t.events.uncombineFeatures({silent:!0}),r},r.setFeatureProperty=function(n,i,u){return t.store.setFeatureProperty(n,i,u),r},r}function yi(n){bf(n,this)}var pi=function(n,t){var r={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},u={on:function(n,t,i){if(r[n]===undefined)throw new Error("Invalid event type: "+n);r[n].push({selector:t,fn:i})},render:function(n){t.store.featureChanged(n)}},i=function(n,i){for(var e=r[n],o=e.length,f,s;o--;)if(f=e[o],f.selector(i)){s=f.fn.call(u,i);s||t.store.render();t.ui.updateMapClasses();break}};return n.start.call(u),{render:n.render,stop:function(){n.stop&&n.stop()},trash:function(){n.trash&&(n.trash(),t.store.render())},combineFeatures:function(){n.combineFeatures&&n.combineFeatures()},uncombineFeatures:function(){n.uncombineFeatures&&n.uncombineFeatures()},drag:function(n){i("drag",n)},click:function(n){i("click",n)},mousemove:function(n){i("mousemove",n)},mousedown:function(n){i("mousedown",n)},mouseup:function(n){i("mouseup",n)},mouseout:function(n){i("mouseout",n)},keydown:function(n){i("keydown",n)},keyup:function(n){i("keyup",n)},touchstart:function(n){i("touchstart",n)},touchmove:function(n){i("touchmove",n)},touchend:function(n){i("touchend",n)},tap:function(n){i("tap",n)}}},wi={},wt={},bi,uu,ft,eu,ou,rr,gt,rt,nt,v,fr,su,cu,lu,ut,au,er,yu,pu,wu,du,vt,cr,yt,r,it,d,g,pt,vf,yr,pf,wf,bf;wt.RADIUS=6378137;wt.FLATTENING=1/298.257223563;wt.POLAR_RADIUS=6356752.3142;bi=wt;wi.geometry=pr;wi.ring=ki;var y={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},w={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},e={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},a={POLYGON:"polygon",LINE:"line_string",POINT:"point"},n={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},i={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},p={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},gi={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},s={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},o={ACTIVE:"true",INACTIVE:"false"},br=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],kr=-90,bt=-85,dr=90,kt=85,gr=-270,nu=270,df=Object.freeze({__proto__:null,classes:y,sources:w,cursors:e,types:a,geojsonTypes:n,modes:i,events:p,updateActions:gi,meta:s,activeStates:o,interactions:br,LAT_MIN:kr,LAT_RENDERED_MIN:bt,LAT_MAX:dr,LAT_RENDERED_MAX:kt,LNG_MIN:gr,LNG_MAX:nu}),tu={Point:0,LineString:1,MultiLineString:1,Polygon:2};b.prototype.add=function(n){return this.has(n)?this:(this._length++,typeof n=="string"?this._items[n]=this._length:this._nums[n]=this._length,this)};b.prototype.delete=function(n){return this.has(n)===!1?this:(this._length--,delete this._items[n],delete this._nums[n],this)};b.prototype.has=function(n){return typeof n!="string"&&typeof n!="number"?!1:this._items[n]!==undefined||this._nums[n]!==undefined};b.prototype.values=function(){var t=this,n=[];return Object.keys(this._items).forEach(function(i){n.push({k:i,v:t._items[i]})}),Object.keys(this._nums).forEach(function(i){n.push({k:JSON.parse(i),v:t._nums[i]})}),n.sort(function(n,t){return n.v-t.v}).map(function(n){return n.k})};b.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};uu=[s.FEATURE,s.MIDPOINT,s.VERTEX];ft={click:ne,touch:te};var ie=4,re=12,ue=500;eu=25;ou=250;rr={exports:{}};gt=rr.exports=function(n,t){var u,e,r,i,s,f,o;if(t||(t=16),n===undefined&&(n=128),n<=0)return"0";for(u=Math.log(Math.pow(2,n))/Math.log(t),i=2;u===Infinity;i*=2)u=Math.log(Math.pow(2,n/i))/Math.log(t)*i;for(e=u-Math.floor(u),r="",i=0;i<Math.floor(u);i++)f=Math.floor(Math.random()*t).toString(t),r=f+r;return e&&(s=Math.pow(t,e),f=Math.floor(Math.random()*s).toString(t),r=f+r),o=parseInt(r,t),o!==Infinity&&o>=Math.pow(2,n)?gt(n,t):r};gt.rack=function(n,t,i){var r=function(r){var e=0,f;do{if(e++>10)if(i)n+=i;else throw new Error("too many ID collisions, use more bits");f=gt(n,t)}while(Object.hasOwnProperty.call(u,f));return u[f]=r,f},u=r.hats={};return r.get=function(n){return r.hats[n]},r.set=function(n,t){return r.hats[n]=t,r},r.bits=n||128,r.base=t||16,r};var fe=rr.exports,ur=ot(fe),h=function(n,t){this.ctx=n;this.properties=t.properties||{};this.coordinates=t.geometry.coordinates;this.id=t.id||ur();this.type=t.geometry.type};h.prototype.changed=function(){this.ctx.store.featureChanged(this.id)};h.prototype.incomingCoords=function(n){this.setCoordinates(n)};h.prototype.setCoordinates=function(n){this.coordinates=n;this.changed()};h.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))};h.prototype.setProperty=function(n,t){this.properties[n]=t};h.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:n.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))};h.prototype.internal=function(t){var r={id:this.id,meta:s.FEATURE,"meta:type":this.type,active:o.INACTIVE,mode:t},i;if(this.ctx.options.userProperties)for(i in this.properties)r["user_"+i]=this.properties[i];return{type:n.FEATURE,properties:r,geometry:{coordinates:this.getCoordinates(),type:this.type}}};rt=function(n,t){h.call(this,n,t)};rt.prototype=Object.create(h.prototype);rt.prototype.isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"};rt.prototype.updateCoordinate=function(n,t,i){this.coordinates=arguments.length===3?[t,i]:[n,t];this.changed()};rt.prototype.getCoordinate=function(){return this.getCoordinates()};nt=function(n,t){h.call(this,n,t)};nt.prototype=Object.create(h.prototype);nt.prototype.isValid=function(){return this.coordinates.length>1};nt.prototype.addCoordinate=function(n,t,i){this.changed();var r=parseInt(n,10);this.coordinates.splice(r,0,[t,i])};nt.prototype.getCoordinate=function(n){var t=parseInt(n,10);return JSON.parse(JSON.stringify(this.coordinates[t]))};nt.prototype.removeCoordinate=function(n){this.changed();this.coordinates.splice(parseInt(n,10),1)};nt.prototype.updateCoordinate=function(n,t,i){var r=parseInt(n,10);this.coordinates[r]=[t,i];this.changed()};v=function(n,t){h.call(this,n,t);this.coordinates=this.coordinates.map(function(n){return n.slice(0,-1)})};v.prototype=Object.create(h.prototype);v.prototype.isValid=function(){return this.coordinates.length===0?!1:this.coordinates.every(function(n){return n.length>2})};v.prototype.incomingCoords=function(n){this.coordinates=n.map(function(n){return n.slice(0,-1)});this.changed()};v.prototype.setCoordinates=function(n){this.coordinates=n;this.changed()};v.prototype.addCoordinate=function(n,t,i){this.changed();var r=n.split(".").map(function(n){return parseInt(n,10)}),u=this.coordinates[r[0]];u.splice(r[1],0,[t,i])};v.prototype.removeCoordinate=function(n){this.changed();var t=n.split(".").map(function(n){return parseInt(n,10)}),i=this.coordinates[t[0]];i&&(i.splice(t[1],1),i.length<3&&this.coordinates.splice(t[0],1))};v.prototype.getCoordinate=function(n){var t=n.split(".").map(function(n){return parseInt(n,10)}),i=this.coordinates[t[0]];return JSON.parse(JSON.stringify(i[t[1]]))};v.prototype.getCoordinates=function(){return this.coordinates.map(function(n){return n.concat([n[0]])})};v.prototype.updateCoordinate=function(n,t,i){this.changed();var u=n.split("."),r=parseInt(u[0],10),f=parseInt(u[1],10);this.coordinates[r]===undefined&&(this.coordinates[r]=[]);this.coordinates[r][f]=[t,i]};var ee={MultiPoint:rt,MultiLineString:nt,MultiPolygon:v},ni=function(n,t,i,r,u){var f=i.split("."),e=parseInt(f[0],10),o=f[1]?f.slice(1).join("."):null;return n[e][t](o,r,u)},c=function(n,t){if(h.call(this,n,t),delete this.coordinates,this.model=ee[t.geometry.type],this.model===undefined)throw new TypeError(t.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(t.geometry.coordinates)};c.prototype=Object.create(h.prototype);c.prototype._coordinatesToFeatures=function(t){var i=this,r=this.model.bind(this);return t.map(function(t){return new r(i.ctx,{id:ur(),type:n.FEATURE,properties:{},geometry:{coordinates:t,type:i.type.replace("Multi","")}})})};c.prototype.isValid=function(){return this.features.every(function(n){return n.isValid()})};c.prototype.setCoordinates=function(n){this.features=this._coordinatesToFeatures(n);this.changed()};c.prototype.getCoordinate=function(n){return ni(this.features,"getCoordinate",n)};c.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(t){return t.type===n.POLYGON?t.getCoordinates():t.coordinates})))};c.prototype.updateCoordinate=function(n,t,i){ni(this.features,"updateCoordinate",n,t,i);this.changed()};c.prototype.addCoordinate=function(n,t,i){ni(this.features,"addCoordinate",n,t,i);this.changed()};c.prototype.removeCoordinate=function(n){ni(this.features,"removeCoordinate",n);this.changed()};c.prototype.getFeatures=function(){return this.features};t.prototype.setSelected=function(n){return this._ctx.store.setSelected(n)};t.prototype.setSelectedCoordinates=function(n){var t=this;this._ctx.store.setSelectedCoordinates(n);n.reduce(function(n,i){return n[i.feature_id]===undefined&&(n[i.feature_id]=!0,t._ctx.store.get(i.feature_id).changed()),n},{})};t.prototype.getSelected=function(){return this._ctx.store.getSelected()};t.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()};t.prototype.isSelected=function(n){return this._ctx.store.isSelected(n)};t.prototype.getFeature=function(n){return this._ctx.store.get(n)};t.prototype.select=function(n){return this._ctx.store.select(n)};t.prototype.deselect=function(n){return this._ctx.store.deselect(n)};t.prototype.deleteFeature=function(n,t){return t===void 0&&(t={}),this._ctx.store.delete(n,t)};t.prototype.addFeature=function(n){return this._ctx.store.add(n)};t.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()};t.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()};t.prototype.setActionableState=function(n){n===void 0&&(n={});var t={trash:n.trash||!1,combineFeatures:n.combineFeatures||!1,uncombineFeatures:n.uncombineFeatures||!1};return this._ctx.events.actionable(t)};t.prototype.changeMode=function(n,t,i){return t===void 0&&(t={}),i===void 0&&(i={}),this._ctx.events.changeMode(n,t,i)};t.prototype.updateUIClasses=function(n){return this._ctx.ui.queueMapClasses(n)};t.prototype.activateUIButton=function(n){return this._ctx.ui.setActiveButton(n)};t.prototype.featuresAt=function(n,t,i){if(i===void 0&&(i="click"),i!=="click"&&i!=="touch")throw new Error("invalid buffer type");return ft[i](n,t,this._ctx)};t.prototype.newFeature=function(t){var i=t.geometry.type;return i===n.POINT?new rt(this._ctx,t):i===n.LINE_STRING?new nt(this._ctx,t):i===n.POLYGON?new v(this._ctx,t):new c(this._ctx,t)};t.prototype.isInstanceOf=function(t,i){if(t===n.POINT)return i instanceof rt;if(t===n.LINE_STRING)return i instanceof nt;if(t===n.POLYGON)return i instanceof v;if(t==="MultiFeature")return i instanceof c;throw new Error("Unknown feature class: "+t);};t.prototype.doRender=function(n){return this._ctx.store.featureChanged(n)};t.prototype.onSetup=function(){};t.prototype.onDrag=function(){};t.prototype.onClick=function(){};t.prototype.onMouseMove=function(){};t.prototype.onMouseDown=function(){};t.prototype.onMouseUp=function(){};t.prototype.onMouseOut=function(){};t.prototype.onKeyUp=function(){};t.prototype.onKeyDown=function(){};t.prototype.onTouchStart=function(){};t.prototype.onTouchMove=function(){};t.prototype.onTouchEnd=function(){};t.prototype.onTap=function(){};t.prototype.onStop=function(){};t.prototype.onTrash=function(){};t.prototype.onCombineFeature=function(){};t.prototype.onUncombineFeature=function(){};t.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures");};fr={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"};su=Object.keys(fr);f.prototype.createRenderBatch=function(){var n=this,i=this.render,t=0;return this.render=function(){t++},function(){n.render=i;t>0&&n.render()}};f.prototype.setDirty=function(){return this.isDirty=!0,this};f.prototype.featureChanged=function(n){return this._changedFeatureIds.add(n),this};f.prototype.getChangedIds=function(){return this._changedFeatureIds.values()};f.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this};f.prototype.getAllIds=function(){return this._featureIds.values()};f.prototype.add=function(n){return this.featureChanged(n.id),this._features[n.id]=n,this._featureIds.add(n.id),this};f.prototype.delete=function(n,t){var i=this;return t===void 0&&(t={}),lt(n).forEach(function(n){i._featureIds.has(n)&&(i._featureIds.delete(n),i._selectedFeatureIds.delete(n),t.silent||i._deletedFeaturesToEmit.indexOf(i._features[n])===-1&&i._deletedFeaturesToEmit.push(i._features[n]),delete i._features[n],i.isDirty=!0)}),hu(this,t),this};f.prototype.get=function(n){return this._features[n]};f.prototype.getAll=function(){var n=this;return Object.keys(this._features).map(function(t){return n._features[t]})};f.prototype.select=function(n,t){var i=this;return t===void 0&&(t={}),lt(n).forEach(function(n){i._selectedFeatureIds.has(n)||(i._selectedFeatureIds.add(n),i._changedFeatureIds.add(n),t.silent||(i._emitSelectionChange=!0))}),this};f.prototype.deselect=function(n,t){var i=this;return t===void 0&&(t={}),lt(n).forEach(function(n){i._selectedFeatureIds.has(n)&&(i._selectedFeatureIds.delete(n),i._changedFeatureIds.add(n),t.silent||(i._emitSelectionChange=!0))}),hu(this,t),this};f.prototype.clearSelected=function(n){return n===void 0&&(n={}),this.deselect(this._selectedFeatureIds.values(),{silent:n.silent}),this};f.prototype.setSelected=function(n,t){var i=this;return t===void 0&&(t={}),n=lt(n),this.deselect(this._selectedFeatureIds.values().filter(function(t){return n.indexOf(t)===-1}),{silent:t.silent}),this.select(n.filter(function(n){return!i._selectedFeatureIds.has(n)}),{silent:t.silent}),this};f.prototype.setSelectedCoordinates=function(n){return this._selectedCoordinates=n,this._emitSelectionChange=!0,this};f.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this};f.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()};f.prototype.getSelected=function(){var n=this;return this._selectedFeatureIds.values().map(function(t){return n.get(t)})};f.prototype.getSelectedCoordinates=function(){var n=this;return this._selectedCoordinates.map(function(t){var i=n.get(t.feature_id);return{coordinates:i.getCoordinate(t.coord_path)}})};f.prototype.isSelected=function(n){return this._selectedFeatureIds.has(n)};f.prototype.setFeatureProperty=function(n,t,i){this.get(n).setProperty(t,i);this.featureChanged(n)};f.prototype.storeMapConfig=function(){var n=this;br.forEach(function(t){var i=n.ctx.map[t];i&&(n._mapInitialConfig[t]=n.ctx.map[t].isEnabled())})};f.prototype.restoreMapConfig=function(){var n=this;Object.keys(this._mapInitialConfig).forEach(function(t){var i=n._mapInitialConfig[t];i?n.ctx.map[t].enable():n.ctx.map[t].disable()})};f.prototype.getInitialConfigValue=function(n){return this._mapInitialConfig[n]!==undefined?this._mapInitialConfig[n]:!0};cu=ce;lu=Object.prototype.hasOwnProperty;ut=ot(cu);au=["mode","feature","mouse"];er=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];yu=Object.freeze({__proto__:null,isOfMetaType:ti,isShiftMousedown:vu,isActiveFeature:et,isInactiveFeature:or,noTarget:ii,isFeature:sr,isVertex:at,isShiftDown:ri,isEscapeKey:ui,isEnterKey:fi,isTrue:ve});pu=st;st.prototype={clone:function(){return new st(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,t){return this.clone()._rotateAround(n,t)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,i=n.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[0]*this.x+n[1]*this.y,i=n[2]*this.x+n[3]*this.y;return this.x=t,this.y=i,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),i=Math.sin(n),r=t*this.x-i*this.y,u=i*this.x+t*this.y;return this.x=r,this.y=u,this},_rotateAround:function(n,t){var i=Math.cos(n),r=Math.sin(n),u=t.x+i*(this.x-t.x)-r*(this.y-t.y),f=t.y+r*(this.x-t.x)+i*(this.y-t.y);return this.x=u,this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}};st.convert=function(n){return n instanceof st?n:Array.isArray(n)?new st(n[0],n[1]):n};wu=ot(pu);var tt={enable:function(n){setTimeout(function(){n.map&&n.map.doubleClickZoom&&n._ctx&&n._ctx.store&&n._ctx.store.getInitialConfigValue&&n._ctx.store.getInitialConfigValue("doubleClickZoom")&&n.map.doubleClickZoom.enable()},0)},disable:function(n){setTimeout(function(){n.map&&n.map.doubleClickZoom&&n.map.doubleClickZoom.disable()},0)}},oi={exports:{}},ku=pe,ye={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};du=ot(ku);var we=Object.freeze({__proto__:null,"default":si}),be=kf(we),ke=function(n){function t(n){return Array.isArray(n)&&n.length&&typeof n[0]=="number"?[n]:n.reduce(function(n,i){return Array.isArray(i)&&Array.isArray(i[0])?n.concat(t(i)):(n.push(i),n)},[])}return t(n)},de=ku,hi=be,ge=ke;hi instanceof Function||(hi=hi.default);var no=function(n){if(!n)return[];var i=hi(de(n)),t=[];return i.features.forEach(function(n){n.geometry&&(t=t.concat(ge(n.geometry.coordinates)))}),t},gu={exports:{}},to=gu.exports=function(n){return new k(n)};k.prototype.get=function(n){for(var r,t=this.value,i=0;i<n.length;i++){if(r=n[i],!t||!ci.call(t,r)){t=undefined;break}t=t[r]}return t};k.prototype.has=function(n){for(var r,t=this.value,i=0;i<n.length;i++){if(r=n[i],!t||!ci.call(t,r))return!1;t=t[r]}return!0};k.prototype.set=function(n,t){for(var u,i=this.value,r=0;r<n.length-1;r++)u=n[r],ci.call(i,u)||(i[u]={}),i=i[u];return i[n[r]]=t,t};k.prototype.map=function(n){return nf(this.value,n,!0)};k.prototype.forEach=function(n){return this.value=nf(this.value,n,!1),this.value};k.prototype.reduce=function(n,t){var r=arguments.length===1,i=r?this.value:t;return this.forEach(function(t){this.isRoot&&r||(i=n.call(this,i,t))}),i};k.prototype.paths=function(){var n=[];return this.forEach(function(){n.push(this.path)}),n};k.prototype.nodes=function(){var n=[];return this.forEach(function(){n.push(this.node)}),n};k.prototype.clone=function(){var n=[],t=[];return function i(r){for(var f,u=0;u<n.length;u++)if(n[u]===r)return t[u];return typeof r=="object"&&r!==null?(f=tf(r),n.push(r),t.push(f),yt(vt(r),function(n){f[n]=i(r[n])}),n.pop(),t.pop(),f):r}(this.value)};vt=Object.keys||function(n){var t=[];for(var i in n)t.push(i);return t};cr=Array.isArray||function(n){return Object.prototype.toString.call(n)==="[object Array]"};yt=function(n,t){if(n.forEach)return n.forEach(t);for(var i=0;i<n.length;i++)t(n[i],i,n)};yt(vt(k.prototype),function(n){to[n]=function(t){var r=[].slice.call(arguments,1),i=new k(t);return i[n].apply(i,r)}});var ci=Object.hasOwnProperty||function(n,t){return t in n},so=gu.exports,ho=l;l.prototype.include=function(n){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],n[0]),this._bbox[1]=Math.min(this._bbox[1],n[1]),this._bbox[2]=Math.max(this._bbox[2],n[0]),this._bbox[3]=Math.max(this._bbox[3],n[1]),this};l.prototype.equals=function(n){var t;return t=n instanceof l?n.bbox():n,this._bbox[0]==t[0]&&this._bbox[1]==t[1]&&this._bbox[2]==t[2]&&this._bbox[3]==t[3]};l.prototype.center=function(){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null};l.prototype.union=function(n){this._valid=!0;var t;return t=n instanceof l?n.bbox():n,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[2]),this._bbox[3]=Math.max(this._bbox[3],t[3]),this};l.prototype.bbox=function(){return this._valid?this._bbox:null};l.prototype.contains=function(n){if(!n)return this._fastContains();if(!this._valid)return null;var t=n[0],i=n[1];return this._bbox[0]<=t&&this._bbox[1]<=i&&this._bbox[2]>=t&&this._bbox[3]>=i};l.prototype.intersect=function(n){if(!this._valid)return null;var t;return t=n instanceof l?n.bbox():n,!(this._bbox[0]>t[2]||this._bbox[2]<t[0]||this._bbox[3]<t[1]||this._bbox[1]>t[3])};l.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var n="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",n)};l.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var co=no,lo=so,ao=ho,rf={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},vo=Object.keys(rf);oi.exports=function(n){return lr(n).bbox()};oi.exports.polygon=function(n){return lr(n).polygon()};oi.exports.bboxify=function(n){return lo(n).map(function(n){if(n){var t=vo.some(function(t){return n[t]?rf[t].indexOf(n.type)!==-1:!1});t&&(n.bbox=lr(n).bbox(),this.update(n))}})};var yo=oi.exports,po=ot(yo),li=kr,ai=dr,uf=bt,ff=kt,ef=gr,sf=nu;r={};r.onSetup=function(n){var i=this,t={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:undefined,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:n.featureIds||[]};return this.setSelected(t.initiallySelectedFeatureIds.filter(function(n){return i.getFeature(n)!==undefined})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),t};r.fireUpdate=function(){this.map.fire(p.UPDATE,{action:gi.MOVE,features:this.getSelected().map(function(n){return n.toGeoJSON()})})};r.fireActionable=function(){var f=this,n=this.getSelected(),e=n.filter(function(n){return f.isInstanceOf("MultiFeature",n)}),t=!1,i,r,u;n.length>1&&(t=!0,i=n[0].type.replace("Multi",""),n.forEach(function(n){n.type.replace("Multi","")!==i&&(t=!1)}));r=e.length>0;u=n.length>0;this.setActionableState({combineFeatures:t,uncombineFeatures:r,trash:u})};r.getUniqueIds=function(n){if(!n.length)return[];var t=n.map(function(n){return n.properties.id}).filter(function(n){return n!==undefined}).reduce(function(n,t){return n.add(t),n},new b);return t.values()};r.stopExtendedInteractions=function(n){n.boxSelectElement&&(n.boxSelectElement.parentNode&&n.boxSelectElement.parentNode.removeChild(n.boxSelectElement),n.boxSelectElement=null);this.map.dragPan.enable();n.boxSelecting=!1;n.canBoxSelect=!1;n.dragMoving=!1;n.canDragMove=!1};r.onStop=function(){tt.enable(this)};r.onMouseMove=function(n,t){var i=sr(t);return i&&n.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(n),!0};r.onMouseOut=function(n){return n.dragMoving?this.fireUpdate():!0};r.onTap=r.onClick=function(n,t){return ii(t)?this.clickAnywhere(n,t):ti(s.VERTEX)(t)?this.clickOnVertex(n,t):sr(t)?this.clickOnFeature(n,t):void 0};r.clickAnywhere=function(n){var i=this,t=this.getSelectedIds();t.length&&(this.clearSelectedFeatures(),t.forEach(function(n){return i.doRender(n)}));tt.enable(this);this.stopExtendedInteractions(n)};r.clickOnVertex=function(n,t){this.changeMode(i.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat});this.updateUIClasses({mouse:e.MOVE})};r.startOnActiveFeature=function(n,t){this.stopExtendedInteractions(n);this.map.dragPan.disable();this.doRender(t.featureTarget.properties.id);n.canDragMove=!0;n.dragMoveLocation=t.lngLat};r.clickOnFeature=function(t,r){var h=this;tt.disable(this);this.stopExtendedInteractions(t);var f=ri(r),s=this.getSelectedIds(),u=r.featureTarget.properties.id,o=this.isSelected(u);if(!f&&o&&this.getFeature(u).type!==n.POINT)return this.changeMode(i.DIRECT_SELECT,{featureId:u});o&&f?(this.deselect(u),this.updateUIClasses({mouse:e.POINTER}),s.length===1&&tt.enable(this)):!o&&f?(this.select(u),this.updateUIClasses({mouse:e.MOVE})):o||f||(s.forEach(function(n){return h.doRender(n)}),this.setSelected(u),this.updateUIClasses({mouse:e.MOVE}));this.doRender(u)};r.onMouseDown=function(n,t){return et(t)?this.startOnActiveFeature(n,t):this.drawConfig.boxSelect&&vu(t)?this.startBoxSelect(n,t):void 0};r.startBoxSelect=function(n,t){this.stopExtendedInteractions(n);this.map.dragPan.disable();n.boxSelectStartLocation=hr(t.originalEvent,this.map.getContainer());n.canBoxSelect=!0};r.onTouchStart=function(n,t){if(et(t))return this.startOnActiveFeature(n,t)};r.onDrag=function(n,t){return n.canDragMove?this.dragMove(n,t):this.drawConfig.boxSelect&&n.canBoxSelect?this.whileBoxSelect(n,t):void 0};r.whileBoxSelect=function(n,t){n.boxSelecting=!0;this.updateUIClasses({mouse:e.ADD});n.boxSelectElement||(n.boxSelectElement=document.createElement("div"),n.boxSelectElement.classList.add(y.BOX_SELECT),this.map.getContainer().appendChild(n.boxSelectElement));var i=hr(t.originalEvent,this.map.getContainer()),r=Math.min(n.boxSelectStartLocation.x,i.x),o=Math.max(n.boxSelectStartLocation.x,i.x),u=Math.min(n.boxSelectStartLocation.y,i.y),s=Math.max(n.boxSelectStartLocation.y,i.y),f="translate("+r+"px, "+u+"px)";n.boxSelectElement.style.transform=f;n.boxSelectElement.style.WebkitTransform=f;n.boxSelectElement.style.width=o-r+"px";n.boxSelectElement.style.height=s-u+"px"};r.dragMove=function(n,t){n.dragMoving=!0;t.originalEvent.stopPropagation();var i={lng:t.lngLat.lng-n.dragMoveLocation.lng,lat:t.lngLat.lat-n.dragMoveLocation.lat};vr(this.getSelected(),i);n.dragMoveLocation=t.lngLat};r.onTouchEnd=r.onMouseUp=function(n,t){var r=this;if(n.dragMoving)this.fireUpdate();else if(n.boxSelecting){var u=[n.boxSelectStartLocation,hr(t.originalEvent,this.map.getContainer())],f=this.featuresAt(null,u,"click"),i=this.getUniqueIds(f).filter(function(n){return!r.isSelected(n)});i.length&&(this.select(i),i.forEach(function(n){return r.doRender(n)}),this.updateUIClasses({mouse:e.MOVE}))}this.stopExtendedInteractions(n)};r.toDisplayFeatures=function(t,i,r){(i.properties.active=this.isSelected(i.properties.id)?o.ACTIVE:o.INACTIVE,r(i),this.fireActionable(),i.properties.active===o.ACTIVE&&i.geometry.type!==n.POINT)&&ei(i).forEach(r)};r.onTrash=function(){this.deleteFeature(this.getSelectedIds());this.fireActionable()};r.onCombineFeatures=function(){var i=this.getSelected(),u,t,f;if(i.length!==0&&!(i.length<2)){var e=[],r=[],o=i[0].type.replace("Multi","");for(u=0;u<i.length;u++){if(t=i[u],t.type.replace("Multi","")!==o)return;t.type.includes("Multi")?t.getCoordinates().forEach(function(n){e.push(n)}):e.push(t.getCoordinates());r.push(t.toGeoJSON())}r.length>1&&(f=this.newFeature({type:n.FEATURE,properties:r[0].properties,geometry:{type:"Multi"+o,coordinates:e}}),this.addFeature(f),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([f.id]),this.map.fire(p.COMBINE_FEATURES,{createdFeatures:[f.toGeoJSON()],deletedFeatures:r}));this.fireActionable()}};r.onUncombineFeatures=function(){var n=this,i=this.getSelected(),t;if(i.length!==0){var r=[],u=[],f=function(t){var f=i[t];n.isInstanceOf("MultiFeature",f)&&(f.getFeatures().forEach(function(t){n.addFeature(t);t.properties=f.properties;r.push(t.toGeoJSON());n.select([t.id])}),n.deleteFeature(f.id,{silent:!0}),u.push(f.toGeoJSON()))};for(t=0;t<i.length;t++)f(t);r.length>1&&this.map.fire(p.UNCOMBINE_FEATURES,{createdFeatures:r,deletedFeatures:u});this.fireActionable()}};var hf=ti(s.VERTEX),cf=ti(s.MIDPOINT),u={};u.fireUpdate=function(){this.map.fire(p.UPDATE,{action:gi.CHANGE_COORDINATES,features:this.getSelected().map(function(n){return n.toGeoJSON()})})};u.fireActionable=function(n){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:n.selectedCoordPaths.length>0})};u.startDragging=function(n,t){this.map.dragPan.disable();n.canDragMove=!0;n.dragMoveLocation=t.lngLat};u.stopDragging=function(n){this.map.dragPan.enable();n.dragMoving=!1;n.canDragMove=!1;n.dragMoveLocation=null};u.onVertex=function(n,t){var i,r,u;this.startDragging(n,t);i=t.featureTarget.properties;r=n.selectedCoordPaths.indexOf(i.coord_path);ri(t)||r!==-1?ri(t)&&r===-1&&n.selectedCoordPaths.push(i.coord_path):n.selectedCoordPaths=[i.coord_path];u=this.pathsToCoordinates(n.featureId,n.selectedCoordPaths);this.setSelectedCoordinates(u)};u.onMidpoint=function(n,t){this.startDragging(n,t);var i=t.featureTarget.properties;n.feature.addCoordinate(i.coord_path,i.lng,i.lat);this.fireUpdate();n.selectedCoordPaths=[i.coord_path]};u.pathsToCoordinates=function(n,t){return t.map(function(t){return{feature_id:n,coord_path:t}})};u.onFeature=function(n,t){n.selectedCoordPaths.length===0?this.startDragging(n,t):this.stopDragging(n)};u.dragFeature=function(n,t,i){vr(this.getSelected(),i);n.dragMoveLocation=t.lngLat};u.dragVertex=function(t,i,r){for(var e,f=t.selectedCoordPaths.map(function(n){return t.feature.getCoordinate(n)}),s=f.map(function(t){return{type:n.FEATURE,properties:{},geometry:{type:n.POINT,coordinates:t}}}),o=ar(s,r),u=0;u<f.length;u++)e=f[u],t.feature.updateCoordinate(t.selectedCoordPaths[u],e[0]+o.lng,e[1]+o.lat)};u.clickNoTarget=function(){this.changeMode(i.SIMPLE_SELECT)};u.clickInactive=function(){this.changeMode(i.SIMPLE_SELECT)};u.clickActiveFeature=function(n){n.selectedCoordPaths=[];this.clearSelectedCoordinates();n.feature.changed()};u.onSetup=function(t){var i=t.featureId,r=this.getFeature(i),u;if(!r)throw new Error("You must provide a featureId to enter direct_select mode");if(r.type===n.POINT)throw new TypeError("direct_select mode doesn't handle point features");return u={featureId:i,feature:r,dragMoveLocation:t.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:t.coordPath?[t.coordPath]:[]},this.setSelectedCoordinates(this.pathsToCoordinates(i,u.selectedCoordPaths)),this.setSelected(i),tt.disable(this),this.setActionableState({trash:!0}),u};u.onStop=function(){tt.enable(this);this.clearSelectedCoordinates()};u.toDisplayFeatures=function(n,t,i){n.featureId===t.properties.id?(t.properties.active=o.ACTIVE,i(t),ei(t,{map:this.map,midpoints:!0,selectedPaths:n.selectedCoordPaths}).forEach(i)):(t.properties.active=o.INACTIVE,i(t));this.fireActionable(n)};u.onTrash=function(n){n.selectedCoordPaths.sort(function(n,t){return t.localeCompare(n,"en",{numeric:!0})}).forEach(function(t){return n.feature.removeCoordinate(t)});this.fireUpdate();n.selectedCoordPaths=[];this.clearSelectedCoordinates();this.fireActionable(n);n.feature.isValid()===!1&&(this.deleteFeature([n.featureId]),this.changeMode(i.SIMPLE_SELECT,{}))};u.onMouseMove=function(n,t){var i=et(t),r=hf(t),o=cf(t),u=n.selectedCoordPaths.length===0,f;return i&&u?this.updateUIClasses({mouse:e.MOVE}):r&&!u?this.updateUIClasses({mouse:e.MOVE}):this.updateUIClasses({mouse:e.NONE}),f=r||i||o,f&&n.dragMoving&&this.fireUpdate(),this.stopDragging(n),!0};u.onMouseOut=function(n){return n.dragMoving&&this.fireUpdate(),!0};u.onTouchStart=u.onMouseDown=function(n,t){if(hf(t))return this.onVertex(n,t);if(et(t))return this.onFeature(n,t);if(cf(t))return this.onMidpoint(n,t)};u.onDrag=function(n,t){if(n.canDragMove===!0){n.dragMoving=!0;t.originalEvent.stopPropagation();var i={lng:t.lngLat.lng-n.dragMoveLocation.lng,lat:t.lngLat.lat-n.dragMoveLocation.lat};n.selectedCoordPaths.length>0?this.dragVertex(n,t,i):this.dragFeature(n,t,i);n.dragMoveLocation=t.lngLat}};u.onClick=function(n,t){if(ii(t))return this.clickNoTarget(n,t);if(et(t))return this.clickActiveFeature(n,t);if(or(t))return this.clickInactive(n,t);this.stopDragging(n)};u.onTap=function(n,t){return ii(t)?this.clickNoTarget(n,t):et(t)?this.clickActiveFeature(n,t):or(t)?this.clickInactive(n,t):void 0};u.onTouchEnd=u.onMouseUp=function(n){n.dragMoving&&this.fireUpdate();this.stopDragging(n)};it={};it.onSetup=function(){var t=this.newFeature({type:n.FEATURE,properties:{},geometry:{type:n.POINT,coordinates:[]}});return this.addFeature(t),this.clearSelectedFeatures(),this.updateUIClasses({mouse:e.ADD}),this.activateUIButton(a.POINT),this.setActionableState({trash:!0}),{point:t}};it.stopDrawingAndRemove=function(n){this.deleteFeature([n.point.id],{silent:!0});this.changeMode(i.SIMPLE_SELECT)};it.onTap=it.onClick=function(n,t){this.updateUIClasses({mouse:e.MOVE});n.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat);this.map.fire(p.CREATE,{features:[n.point.toGeoJSON()]});this.changeMode(i.SIMPLE_SELECT,{featureIds:[n.point.id]})};it.onStop=function(n){this.activateUIButton();n.point.getCoordinate().length||this.deleteFeature([n.point.id],{silent:!0})};it.toDisplayFeatures=function(n,t,i){var r=t.properties.id===n.point.id;return t.properties.active=r?o.ACTIVE:o.INACTIVE,r?void 0:i(t)};it.onTrash=it.stopDrawingAndRemove;it.onKeyUp=function(n,t){if(ui(t)||fi(t))return this.stopDrawingAndRemove(n,t)};d={};d.onSetup=function(){var t=this.newFeature({type:n.FEATURE,properties:{},geometry:{type:n.POLYGON,coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),tt.disable(this),this.updateUIClasses({mouse:e.ADD}),this.activateUIButton(a.POLYGON),this.setActionableState({trash:!0}),{polygon:t,currentVertexPosition:0}};d.clickAnywhere=function(n,t){if(n.currentVertexPosition>0&&vi(t,n.polygon.coordinates[0][n.currentVertexPosition-1]))return this.changeMode(i.SIMPLE_SELECT,{featureIds:[n.polygon.id]});this.updateUIClasses({mouse:e.ADD});n.polygon.updateCoordinate("0."+n.currentVertexPosition,t.lngLat.lng,t.lngLat.lat);n.currentVertexPosition++;n.polygon.updateCoordinate("0."+n.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)};d.clickOnVertex=function(n){return this.changeMode(i.SIMPLE_SELECT,{featureIds:[n.polygon.id]})};d.onMouseMove=function(n,t){n.polygon.updateCoordinate("0."+n.currentVertexPosition,t.lngLat.lng,t.lngLat.lat);at(t)&&this.updateUIClasses({mouse:e.POINTER})};d.onTap=d.onClick=function(n,t){return at(t)?this.clickOnVertex(n,t):this.clickAnywhere(n,t)};d.onKeyUp=function(n,t){ui(t)?(this.deleteFeature([n.polygon.id],{silent:!0}),this.changeMode(i.SIMPLE_SELECT)):fi(t)&&this.changeMode(i.SIMPLE_SELECT,{featureIds:[n.polygon.id]})};d.onStop=function(n){(this.updateUIClasses({mouse:e.NONE}),tt.enable(this),this.activateUIButton(),this.getFeature(n.polygon.id)!==undefined)&&(n.polygon.removeCoordinate("0."+n.currentVertexPosition),n.polygon.isValid()?this.map.fire(p.CREATE,{features:[n.polygon.toGeoJSON()]}):(this.deleteFeature([n.polygon.id],{silent:!0}),this.changeMode(i.SIMPLE_SELECT,{},{silent:!0})))};d.toDisplayFeatures=function(t,i,r){var e=i.properties.id===t.polygon.id,u,f,h;return(i.properties.active=e?o.ACTIVE:o.INACTIVE,!e)?r(i):i.geometry.coordinates.length===0?void 0:(u=i.geometry.coordinates[0].length,u<3)?void 0:(i.properties.meta=s.FEATURE,r(ht(t.polygon.id,i.geometry.coordinates[0][0],"0.0",!1)),u>3&&(f=i.geometry.coordinates[0].length-3,r(ht(t.polygon.id,i.geometry.coordinates[0][f],"0."+f,!1))),u<=4&&(h=[[i.geometry.coordinates[0][0][0],i.geometry.coordinates[0][0][1]],[i.geometry.coordinates[0][1][0],i.geometry.coordinates[0][1][1]]],r({type:n.FEATURE,properties:i.properties,geometry:{coordinates:h,type:n.LINE_STRING}}),u===3))?void 0:r(i)};d.onTrash=function(n){this.deleteFeature([n.polygon.id],{silent:!0});this.changeMode(i.SIMPLE_SELECT)};g={};g.onSetup=function(t){var o,r,u,s,i,f;if(t=t||{},o=t.featureId,s="forward",o){if(r=this.getFeature(o),!r)throw new Error("Could not find a feature with the provided featureId");if(i=t.from,i&&i.type==="Feature"&&i.geometry&&i.geometry.type==="Point"&&(i=i.geometry),i&&i.type==="Point"&&i.coordinates&&i.coordinates.length===2&&(i=i.coordinates),!i||!Array.isArray(i))throw new Error("Please use the `from` property to indicate which point to continue the line from");if(f=r.coordinates.length-1,r.coordinates[f][0]===i[0]&&r.coordinates[f][1]===i[1])u=f+1,r.addCoordinate.apply(r,[u].concat(r.coordinates[f]));else if(r.coordinates[0][0]===i[0]&&r.coordinates[0][1]===i[1])s="backwards",u=0,r.addCoordinate.apply(r,[u].concat(r.coordinates[0]));else throw new Error("`from` should match the point at either the start or the end of the provided LineString");}else r=this.newFeature({type:n.FEATURE,properties:{},geometry:{type:n.LINE_STRING,coordinates:[]}}),u=0,this.addFeature(r);return this.clearSelectedFeatures(),tt.disable(this),this.updateUIClasses({mouse:e.ADD}),this.activateUIButton(a.LINE),this.setActionableState({trash:!0}),{line:r,currentVertexPosition:u,direction:s}};g.clickAnywhere=function(n,t){if(n.currentVertexPosition>0&&vi(t,n.line.coordinates[n.currentVertexPosition-1])||n.direction==="backwards"&&vi(t,n.line.coordinates[n.currentVertexPosition+1]))return this.changeMode(i.SIMPLE_SELECT,{featureIds:[n.line.id]});this.updateUIClasses({mouse:e.ADD});n.line.updateCoordinate(n.currentVertexPosition,t.lngLat.lng,t.lngLat.lat);n.direction==="forward"?(n.currentVertexPosition++,n.line.updateCoordinate(n.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):n.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)};g.clickOnVertex=function(n){return this.changeMode(i.SIMPLE_SELECT,{featureIds:[n.line.id]})};g.onMouseMove=function(n,t){n.line.updateCoordinate(n.currentVertexPosition,t.lngLat.lng,t.lngLat.lat);at(t)&&this.updateUIClasses({mouse:e.POINTER})};g.onTap=g.onClick=function(n,t){if(at(t))return this.clickOnVertex(n,t);this.clickAnywhere(n,t)};g.onKeyUp=function(n,t){fi(t)?this.changeMode(i.SIMPLE_SELECT,{featureIds:[n.line.id]}):ui(t)&&(this.deleteFeature([n.line.id],{silent:!0}),this.changeMode(i.SIMPLE_SELECT))};g.onStop=function(n){(tt.enable(this),this.activateUIButton(),this.getFeature(n.line.id)!==undefined)&&(n.line.removeCoordinate(""+n.currentVertexPosition),n.line.isValid()?this.map.fire(p.CREATE,{features:[n.line.toGeoJSON()]}):(this.deleteFeature([n.line.id],{silent:!0}),this.changeMode(i.SIMPLE_SELECT,{},{silent:!0})))};g.onTrash=function(n){this.deleteFeature([n.line.id],{silent:!0});this.changeMode(i.SIMPLE_SELECT)};g.toDisplayFeatures=function(n,t,i){var r=t.properties.id===n.line.id;if(t.properties.active=r?o.ACTIVE:o.INACTIVE,!r)return i(t);t.geometry.coordinates.length<2||(t.properties.meta=s.FEATURE,i(ht(n.line.id,t.geometry.coordinates[n.direction==="forward"?t.geometry.coordinates.length-2:1],""+(n.direction==="forward"?t.geometry.coordinates.length-2:1),!1)),i(t))};var lf={simple_select:r,direct_select:u,draw_point:it,draw_polygon:d,draw_line_string:g},wo={defaultMode:i.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:er,modes:lf,controls:{},userProperties:!1},bo={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},ko={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};return pt={exports:{}},pt.exports,function(n,t){function iu(n,t){for(var i=-1,f=n==null?0:n.length,e=0,u=[],r;++i<f;)r=n[i],t(r,i,n)&&(u[e++]=r);return u}function ru(n,t){for(var i=-1,r=t.length,u=n.length;++i<r;)n[u+i]=t[i];return n}function uu(n,t){for(var i=-1,r=n==null?0:n.length;++i<r;)if(t(n[i],i,n))return!0;return!1}function fu(n,t){for(var i=-1,r=Array(n);++i<n;)r[i]=t(i);return r}function eu(n){return function(t){return n(t)}}function ou(n,t){return n.has(t)}function su(n,t){return n==null?undefined:n[t]}function hu(n){var i=-1,t=Array(n.size);return n.forEach(function(n,r){t[++i]=[r,n]}),t}function cu(n,t){return function(i){return n(t(i))}}function lu(n){var i=-1,t=Array(n.size);return n.forEach(function(n){t[++i]=n}),t}function h(n){var i=-1,r=n==null?0:n.length,t;for(this.clear();++i<r;)t=n[i],this.set(t[0],t[1])}function rf(){this.__data__=p?p(null):{};this.size=0}function uf(n){var t=this.has(n)&&delete this.__data__[n];return this.size-=t?1:0,t}function ff(n){var t=this.__data__,i;return p?(i=t[n],i===ht?undefined:i):r.call(t,n)?t[n]:undefined}function ef(n){var t=this.__data__;return p?t[n]!==undefined:r.call(t,n)}function sf(n,t){var i=this.__data__;return this.size+=this.has(n)?0:1,i[n]=p&&t===undefined?ht:t,this}function f(n){var i=-1,r=n==null?0:n.length,t;for(this.clear();++i<r;)t=n[i],this.set(t[0],t[1])}function hf(){this.__data__=[];this.size=0}function cf(n){var t=this.__data__,i=et(t,n),r;return i<0?!1:(r=t.length-1,i==r?t.pop():pu.call(t,i,1),--this.size,!0)}function lf(n){var t=this.__data__,i=et(t,n);return i<0?undefined:t[i][1]}function af(n){return et(this.__data__,n)>-1}function vf(n,t){var i=this.__data__,r=et(i,n);return r<0?(++this.size,i.push([n,t])):i[r][1]=t,this}function c(n){var i=-1,r=n==null?0:n.length,t;for(this.clear();++i<r;)t=n[i],this.set(t[0],t[1])}function yf(){this.size=0;this.__data__={hash:new h,map:new(y||f),string:new h}}function pf(n){var t=ot(this,n)["delete"](n);return this.size-=t?1:0,t}function wf(n){return ot(this,n).get(n)}function bf(n){return ot(this,n).has(n)}function kf(n,t){var i=ot(this,n),r=i.size;return i.set(n,t),this.size+=i.size==r?0:1,this}function ft(n){var t=-1,i=n==null?0:n.length;for(this.__data__=new c;++t<i;)this.add(n[t])}function df(n){return this.__data__.set(n,ht),this}function gf(n){return this.__data__.has(n)}function o(n){var t=this.__data__=new f(n);this.size=t.size}function ne(){this.__data__=new f;this.size=0}function te(n){var t=this.__data__,i=t["delete"](n);return this.size=t.size,i}function ie(n){return this.__data__.get(n)}function re(n){return this.__data__.has(n)}function ue(n,t){var i=this.__data__,r;if(i instanceof f){if(r=i.__data__,!y||r.length<vr-1)return r.push([n,t]),this.size=++i.size,this;i=this.__data__=new c(r)}return i.set(n,t),this.size=i.size,this}function fe(n,t){var u=b(n),f=!u&&hr(n),e=!u&&!f&&st(n),s=!u&&!f&&!e&&dt(n),h=u||f||e||s,o=h?fu(n.length,String):[],c=o.length;for(var i in n)!(t||r.call(n,i))||h&&(i=="length"||e&&(i=="offset"||i=="parent")||s&&(i=="buffer"||i=="byteLength"||i=="byteOffset")||ye(i,c))||o.push(i);return o}function et(n,t){for(var i=n.length;i--;)if(sr(n[i][0],t))return i;return-1}function ee(n,t,i){var r=t(n);return b(n)?r:ru(r,i(n))}function w(n){return n==null?n===undefined?dr:wr:s&&s in Object(n)?ve(n):ke(n)}function rr(n){return k(n)&&w(n)==g}function ur(n,t,i,r,u){return n===t?!0:n==null||t==null||!k(n)&&!k(t)?n!==n&&t!==t:oe(n,t,i,r,ur,u)}function oe(n,t,i,u,f,s){var l=b(n),tt=b(t),h=l?ct:e(n),c=tt?ct:e(t),p,w,k,nt;h=h==g?a:h;c=c==g?a:c;var v=h==a,it=c==a,y=h==c;if(y&&st(n)){if(!st(t))return!1;l=!0;v=!1}return y&&!v?(s||(s=new o),l||dt(n)?fr(n,t,i,u,f,s):le(n,t,h,i,u,f,s)):!(i&d)&&(p=v&&r.call(n,"__wrapped__"),w=it&&r.call(t,"__wrapped__"),p||w)?(k=p?n.value():n,nt=w?t.value():t,s||(s=new o),f(k,nt,i,u,s)):y?(s||(s=new o),ae(n,t,i,u,f,s)):!1}function se(n){if(!ar(n)||we(n))return!1;var t=cr(n)?yu:gr;return t.test(l(n))}function he(n){return k(n)&&lr(n.length)&&!!i[w(n)]}function ce(n){var i,t;if(!be(n))return bu(n);i=[];for(t in Object(n))r.call(n,t)&&t!="constructor"&&i.push(t);return i}function fr(n,t,i,r,u,f){var y=i&d,c=n.length,p=t.length,l,e,s,v;if(c!=p&&!(y&&p>c))return!1;if(l=f.get(n),l&&f.get(t))return l==t;var o=-1,h=!0,a=i&gt?new ft:undefined;for(f.set(n,t),f.set(t,n);++o<c;){if(e=n[o],s=t[o],r&&(v=y?r(s,e,o,t,n,f):r(e,s,o,n,t,f)),v!==undefined){if(v)continue;h=!1;break}if(a){if(!uu(t,function(n,t){if(!ou(a,t)&&(e===n||u(e,n,i,r,f)))return a.push(t)})){h=!1;break}}else if(!(e===s||u(e,s,i,r,f))){h=!1;break}}return f["delete"](n),f["delete"](t),h}function le(n,t,i,r,u,f,e){var o,h,s,c;switch(i){case it:if(n.byteLength!=t.byteLength||n.byteOffset!=t.byteOffset)return!1;n=n.buffer;t=t.buffer;case hi:return n.byteLength!=t.byteLength||!f(new gi(n),new gi(t))?!1:!0;case ti:case ii:case fi:return sr(+n,+t);case ri:return n.name==t.name&&n.message==t.message;case oi:case si:return n==t+"";case nt:o=hu;case tt:return(h=r&d,o||(o=lu),n.size!=t.size&&!h)?!1:(s=e.get(n),s)?s==t:(r|=gt,e.set(n,t),c=fr(o(n),o(t),r,u,f,e),e["delete"](n),c);case kr:if(kt)return kt.call(n)==kt.call(t)}return!1}function ae(n,t,i,u,f,e){var y=i&d,w=er(n),b=w.length,nt=er(t),tt=nt.length,s,o,k,h,p,c,l,g,a,v;if(b!=tt&&!y)return!1;for(s=b;s--;)if(o=w[s],!(y?o in t:r.call(t,o)))return!1;if(k=e.get(n),k&&e.get(t))return k==t;for(h=!0,e.set(n,t),e.set(t,n),p=y;++s<b;){if(o=w[s],c=n[o],l=t[o],u&&(g=y?u(l,c,o,t,n,e):u(c,l,o,n,t,e)),!(g===undefined?c===l||f(c,l,i,u,e):g)){h=!1;break}p||(p=o=="constructor")}return h&&!p&&(a=n.constructor,v=t.constructor,a!=v&&"constructor"in n&&"constructor"in t&&!(typeof a=="function"&&a instanceof a&&typeof v=="function"&&v instanceof v)&&(h=!1)),e["delete"](n),e["delete"](t),h}function er(n){return ee(n,no,or)}function ot(n,t){var i=n.__data__;return pe(t)?i[typeof t=="string"?"string":"hash"]:i.map}function v(n,t){var i=su(n,t);return se(i)?i:undefined}function ve(n){var u=r.call(n,s),f=n[s],t,i;try{n[s]=undefined;t=!0}catch(e){}return i=ki.call(n),t&&(u?n[s]=f:delete n[s]),i}function ye(n,t){return t=t==null?ni:t,!!t&&(typeof n=="number"||nu.test(n))&&n>-1&&n%1==0&&n<t}function pe(n){var t=typeof n;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?n!=="__proto__":n===null}function we(n){return!!bi&&bi in n}function be(n){var t=n&&n.constructor,i=typeof t=="function"&&t.prototype||rt;return n===i}function ke(n){return ki.call(n)}function l(n){if(n!=null){try{return wi.call(n)}catch(t){}try{return n+""}catch(i){}}return""}function sr(n,t){return n===t||n!==n&&t!==t}function de(n){return n!=null&&lr(n.length)&&!cr(n)}function ge(n,t){return ur(n,t)}function cr(n){if(!ar(n))return!1;var t=w(n);return t==ui||t==pr||t==yr||t==br}function lr(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=ni}function ar(n){var t=typeof n;return n!=null&&(t=="object"||t=="function")}function k(n){return n!=null&&typeof n=="object"}function no(n){return de(n)?fe(n):ce(n)}function to(){return[]}function io(){return!1}var vr=200,ht="__lodash_hash_undefined__",d=1,gt=2,ni=9007199254740991,g="[object Arguments]",ct="[object Array]",yr="[object AsyncFunction]",ti="[object Boolean]",ii="[object Date]",ri="[object Error]",ui="[object Function]",pr="[object GeneratorFunction]",nt="[object Map]",fi="[object Number]",wr="[object Null]",a="[object Object]",ei="[object Promise]",br="[object Proxy]",oi="[object RegExp]",tt="[object Set]",si="[object String]",kr="[object Symbol]",dr="[object Undefined]",lt="[object WeakMap]",hi="[object ArrayBuffer]",it="[object DataView]",gr=/^\[object .+?Constructor\]$/,nu=/^(?:0|[1-9]\d*)$/,i={},or,e,hr,b,st,dt;i["[object Float32Array]"]=i["[object Float64Array]"]=i["[object Int8Array]"]=i["[object Int16Array]"]=i["[object Int32Array]"]=i["[object Uint8Array]"]=i["[object Uint8ClampedArray]"]=i["[object Uint16Array]"]=i["[object Uint32Array]"]=!0;i[g]=i[ct]=i[hi]=i[ti]=i[it]=i[ii]=i[ri]=i[ui]=i[nt]=i[fi]=i[a]=i[oi]=i[tt]=i[si]=i[lt]=!1;var ci=typeof global=="object"&&global&&global.Object===Object&&global,tu=typeof self=="object"&&self&&self.Object===Object&&self,u=ci||tu||Function("return this")(),li=t&&!t.nodeType&&t,ai=li&&!0&&n&&!n.nodeType&&n,vi=ai&&ai.exports===li,at=vi&&ci.process,yi=function(){try{return at&&at.binding&&at.binding("util")}catch(n){}}(),pi=yi&&yi.isTypedArray;var au=Array.prototype,vu=Function.prototype,rt=Object.prototype,vt=u["__core-js_shared__"],wi=vu.toString,r=rt.hasOwnProperty,bi=function(){var n=/[^.]+$/.exec(vt&&vt.keys&&vt.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}(),ki=rt.toString,yu=RegExp("^"+wi.call(r).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),di=vi?u.Buffer:undefined,ut=u.Symbol,gi=u.Uint8Array,nr=rt.propertyIsEnumerable,pu=au.splice,s=ut?ut.toStringTag:undefined,tr=Object.getOwnPropertySymbols,wu=di?di.isBuffer:undefined,bu=cu(Object.keys,Object),yt=v(u,"DataView"),y=v(u,"Map"),pt=v(u,"Promise"),wt=v(u,"Set"),bt=v(u,"WeakMap"),p=v(Object,"create"),ku=l(yt),du=l(y),gu=l(pt),nf=l(wt),tf=l(bt),ir=ut?ut.prototype:undefined,kt=ir?ir.valueOf:undefined;h.prototype.clear=rf;h.prototype["delete"]=uf;h.prototype.get=ff;h.prototype.has=ef;h.prototype.set=sf;f.prototype.clear=hf;f.prototype["delete"]=cf;f.prototype.get=lf;f.prototype.has=af;f.prototype.set=vf;c.prototype.clear=yf;c.prototype["delete"]=pf;c.prototype.get=wf;c.prototype.has=bf;c.prototype.set=kf;ft.prototype.add=ft.prototype.push=df;ft.prototype.has=gf;o.prototype.clear=ne;o.prototype["delete"]=te;o.prototype.get=ie;o.prototype.has=re;o.prototype.set=ue;or=tr?function(n){return n==null?[]:(n=Object(n),iu(tr(n),function(t){return nr.call(n,t)}))}:to;e=w;(yt&&e(new yt(new ArrayBuffer(1)))!=it||y&&e(new y)!=nt||pt&&e(pt.resolve())!=ei||wt&&e(new wt)!=tt||bt&&e(new bt)!=lt)&&(e=function(n){var t=w(n),i=t==a?n.constructor:undefined,r=i?l(i):"";if(r)switch(r){case ku:return it;case du:return nt;case gu:return ei;case nf:return tt;case tf:return lt}return t});hr=rr(function(){return arguments}())?rr:function(n){return k(n)&&r.call(n,"callee")&&!nr.call(n,"callee")};b=Array.isArray;st=wu||io;dt=pi?eu(pi):he;n.exports=ge}(pt,pt.exports),vf=pt.exports,yr=ot(vf),pf={Polygon:v,LineString:nt,Point:rt,MultiPolygon:c,MultiLineString:c,MultiPoint:c},wf=Object.freeze({__proto__:null,CommonSelectors:yu,constrainFeatureMovement:ar,createMidPoint:bu,createSupplementaryPoints:ei,createVertex:ht,doubleClickZoom:tt,euclideanDistance:nr,featuresAt:ft,getFeatureAtAndSetCursors:dt,isClick:tr,isEventAtCoordinates:vi,isTap:ir,mapEventToBoundingBox:ru,ModeHandler:pi,moveFeatures:vr,sortFeatures:iu,stringSetsAreEqual:yf,StringSet:b,theme:er,toDenseArray:lt}),bf=function(n,t){var i,r;return n=go(n),i={options:n},t=ns(i,t),i.api=t,r=ae(i),t.onAdd=r.onAdd,t.onRemove=r.onRemove,t.types=a,t.options=n,t},yi.modes=lf,yi.constants=df,yi.lib=wf,yi});