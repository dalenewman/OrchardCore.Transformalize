$(document).ready(function(){function n(n){$("#id_content").html(n);var f="";f=settings.controller==="Form"?settings.updateUrl:$("#id_submit").val()==="Run"?settings.runUrl:settings.updateUrl;$("#id_form").attr("action",f);$("#id_form").parsley({errorsContainer:function(n){return n.$element.closest("div.form-group").find("span.help-container")},errorsWrapper:'<span class="help-container"><\/span>',errorTemplate:'<span class="help-block"><\/span> ',excluded:"input[type=button], input[type=submit], input[type=reset], input[type=file]",inputs:"input, textarea, select, input[type=hidden]"});settings.location.enabled&&i();settings.googlePlacesAutocomplete&&setTimeout(function(){initAutocomplete()},500);u();$("select[data-tfl-post-back='true'],input[data-tfl-post-back='true'],textarea[data-tfl-post-back='true']").change(function(){$(this).parsley().isValid()?t():$(this).parsley().validate()});$("select[data-tfl-post-back='false'],input[data-tfl-post-back='false'],textarea[data-tfl-post-back='false']").change(function(){$(this).parsley().validate()});$("select,input:not(input[type='submit'])").keydown(function(n){var i=n.keyCode||n.which,t;return i===13?(n.preventDefault(),t=$(this).closest("form").find(":input"),t.eq(t.index(this)+1).focus(),!1):!0});$("select,input,textarea").focusin(function(){$("#id_focus").val($(this).attr("name"));$(this).attr("type")==="file"&&$(this).parent().addClass("focus");console.log($(this).attr("name")+" has focus")});$("input").focusout(function(){$(this).attr("type")==="file"&&$(this).parent().removeClass("focus")});$("#id_form").submit(function(){r()});$("#id_location_button").click(function(){i()});$("#id_form").areYouSure();setTimeout(function(){$("#id_method").val()!=="GET"&&$("#id_form").addClass("dirty")},1e3)}function t(){$.ajax({url:settings.ajaxUrl,type:"POST",data:$("#id_form").serialize(),success:function(t){n(t)},error:function(t){n(t)}},"html")}function u(){var t=$("#id_focus").val(),n;console.log("setting focus to "+t);n=$("#id_"+t);n.length>0?n.focus().select():$("input[name='"+t+"']:checked").focus();navigator.userAgent.match(/(ip(hone|od|ad))/i)&&n.is("select")&&n.closest("div").prev().has("select").length>0&&n.blur()}function i(){var t=$("#id_location_button"),n=$("#id_location_accuracy"),r=t.find("div.spinner-border"),i=t.find("span.fa-location-arrow"),f=function(){t.removeClass("btn-success").addClass("btn-danger")},u=function(){t.removeClass("btn-danger").addClass("btn-success")};if("geolocation"in navigator){var e={enableHighAccuracy:settings.location.enableHighAccuracy,maximumAge:settings.location.maximumAge<0?Infinity:settings.location.maximumAge,timeout:settings.location.timeout<0?Infinity:settings.location.timeout},o=function(t){settings.location.latitude.val(t.coords.latitude);settings.location.longitude.val(t.coords.longitude);settings.location.accuracy.val(t.coords.accuracy);settings.location.altitude.val(t.coords.altitude);settings.location.altitudeaccuracy.val(t.coords.altitudeAccuracy);settings.location.speed.val(t.coords.speed);settings.location.heading.val(t.coords.heading);u();r.hide();n.text(t.coords.accuracy);console.log(t);setTimeout(function(){n.text("");i.fadeIn()},3e3)},s=function(t){f();r.hide();console.log(t);i.hide();switch(t.code){case t.PERMISSION_DENIED:n.text("Blocked");break;case t.POSITION_UNAVAILABLE:n.text("Unknown");break;case t.TIMEOUT:n.text("Timeout");break;case t.UNKNOWN_ERROR:n.text("Error")}setTimeout(function(){u();n.text("");i.fadeIn()},3e3)};i.hide();r.show();navigator.geolocation.getCurrentPosition(o,s,e)}else t.removeClass("btn-success").addClass("btn-warning"),t.prop("disabled",!0)}function r(){$("#busy").show();$.blockUI({message:null,css:{border:"none",padding:"15px",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px",opacity:.5,color:"#fff",baseZ:1021}})}bsCustomFileInput.init();window.Parsley.on("field:error",function(){this.$element.closest("div.form-group").addClass("is-invalid").removeClass("is-valid");this.$element.addClass("is-invalid").removeClass("is-valid")});window.Parsley.on("field:success",function(){this.$element.closest("div.form-group").removeClass("is-invalid").addClass("is-valid").find(".help-block").empty();this.$element.removeClass("is-invalid").addClass("is-valid")});window.Parsley.addValidator("string",{requirementType:"date",validateString:function(n){return moment(n).isValid()},messages:{en:"This value should be a date"}});$(document).bind("ajaxSend",function(){r()}).bind("ajaxComplete",function(){$("#busy").hide();$.unblockUI()});$("#id_validate_button").bind("click",function(){t()});n()});