(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)})(function(n){"use strict";function u(n,i){var a=i.line,f=0,v=0,y=t.exec(n.getLine(a)),o=y[1];do{f+=1;var s=a+f,h=n.getLine(s),r=t.exec(h);if(r){var e=r[1],c=parseInt(y[3],10)+f-v,u=parseInt(r[3],10),l=u;if(o!==e||isNaN(u)){if(o.length>e.length)return;if(o.length<e.length&&f===1)return;v+=1}else c===u&&(l=u+1),c>u&&(l=c+1),n.replaceRange(h.replace(t,e+l+r[4]+r[5]),{line:s,ch:0},{line:s,ch:h.length})}}while(r)}var t=/^(\s*)(>[> ]*|[*+-] \[[x ]\]\s|[*+-]\s|(\d+)([.)]))(\s*)/,i=/^(\s*)(>[> ]*|[*+-] \[[x ]\]|[*+-]|(\d+)[.)])(\s*)$/,r=/[*+-]\s/;n.commands.newlineAndIndentContinueMarkdownList=function(f){var c,l,o,p,w;if(f.getOption("disableInput"))return n.Pass;for(c=f.listSelections(),l=[],o=0;o<c.length;o++){var s=c[o].head,a=f.getStateAfter(s.line),v=n.innerMode(f.getMode(),a);if(v.mode.name!=="markdown"){f.execCommand("newlineAndIndent");return}a=v.state;var k=a.list!==!1,y=a.quote!==0,h=f.getLine(s.line),e=t.exec(h),d=/^\s*$/.test(h.slice(0,s.ch));if(!c[o].empty()||!k&&!y||!e||d){f.execCommand("newlineAndIndent");return}if(i.test(h))p=y&&/>\s*$/.test(h),w=!/>\s*$/.test(h),(p||w)&&f.replaceRange("",{line:s.line,ch:0},{line:s.line,ch:s.ch+1}),l[o]="\n";else{var g=e[1],nt=e[5],b=!(r.test(e[2])||e[2].indexOf(">")>=0),tt=b?parseInt(e[3],10)+1+e[4]:e[2].replace("x"," ");l[o]="\n"+g+tt+nt;b&&u(f,s)}}f.replaceSelections(l)}});