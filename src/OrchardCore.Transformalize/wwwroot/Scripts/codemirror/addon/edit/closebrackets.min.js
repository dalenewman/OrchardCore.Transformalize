(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)})(function(n){function i(n,t){return t=="pairs"&&typeof n=="string"?n:typeof n=="object"&&n[t]!=null?n[t]:f[t]}function e(n){for(var i,u,t=0;t<n.length;t++)i=n.charAt(t),u="'"+i+"'",r[u]||(r[u]=s(i))}function s(n){return function(t){return a(t,n)}}function u(n){var t=n.state.closeBrackets,i;return!t||t.override?t:(i=n.getModeAt(n.getCursor()),i.closeBrackets||t)}function h(r){var c=u(r),l,e,h,f,s;if(!c||r.getOption("disableInput"))return n.Pass;for(l=i(c,"pairs"),e=r.listSelections(),f=0;f<e.length;f++)if(!e[f].empty()||(h=o(r,e[f].head),!h||l.indexOf(h)%2!=0))return n.Pass;for(f=e.length-1;f>=0;f--)s=e[f].head,r.replaceRange("",t(s.line,s.ch-1),t(s.line,s.ch+1),"+delete")}function c(t){var s=u(t),h=s&&i(s,"explode"),r,f,e;if(!h||t.getOption("disableInput"))return n.Pass;for(r=t.listSelections(),f=0;f<r.length;f++)if(!r[f].empty()||(e=o(t,r[f].head),!e||h.indexOf(e)%2!=0))return n.Pass;t.operation(function(){var u=t.lineSeparator()||"\n",n,i;for(t.replaceSelection(u+u,null),t.execCommand("goCharLeft"),r=t.listSelections(),n=0;n<r.length;n++)i=r[n].head.line,t.indentLine(i,null,!0),t.indentLine(i+1,null,!0)})}function l(i){var r=n.cmpPos(i.anchor,i.head)>0;return{anchor:new t(i.anchor.line,i.anchor.ch+(r?-1:1)),head:new t(i.head.line,i.head.ch+(r?1:-1))}}function a(r,f){var p=u(r),a,o,b,g,h,k;if(!p||r.getOption("disableInput")||(a=i(p,"pairs"),o=a.indexOf(f),o==-1))return n.Pass;var rt=i(p,"closeBefore"),nt=i(p,"triples"),w=a.charAt(o+1)==f,tt=r.listSelections(),d=o%2==0,s;for(b=0;b<tt.length;b++){var it=tt[b],e=it.head,c,y=r.getRange(e,t(e.line,e.ch+1));if(d&&!it.empty())c="surround";else if((w||!d)&&y==f)c=w&&v(r,e)?"both":nt.indexOf(f)>=0&&r.getRange(e,t(e.line,e.ch+3))==f+f+f?"skipThree":"skip";else if(w&&e.ch>1&&nt.indexOf(f)>=0&&r.getRange(t(e.line,e.ch-2),e)==f+f){if(e.ch>2&&/\bstring/.test(r.getTokenTypeAt(t(e.line,e.ch-2))))return n.Pass;c="addFour"}else if(w){if(g=e.ch==0?" ":r.getRange(t(e.line,e.ch-1),e),n.isWordChar(y)||g==f||n.isWordChar(g))return n.Pass;c="both"}else if(d&&(y.length===0||/\s/.test(y)||rt.indexOf(y)>-1))c="both";else return n.Pass;if(s){if(s!=c)return n.Pass}else s=c}h=o%2?a.charAt(o-1):f;k=o%2?f:a.charAt(o+1);r.operation(function(){var t,n;if(s=="skip")r.execCommand("goCharRight");else if(s=="skipThree")for(n=0;n<3;n++)r.execCommand("goCharRight");else if(s=="surround"){for(t=r.getSelections(),n=0;n<t.length;n++)t[n]=h+t[n]+k;for(r.replaceSelections(t,"around"),t=r.listSelections().slice(),n=0;n<t.length;n++)t[n]=l(t[n]);r.setSelections(t)}else s=="both"?(r.replaceSelection(h+k,null),r.triggerElectric(h+k),r.execCommand("goCharLeft")):s=="addFour"&&(r.replaceSelection(h+h+h+h,"before"),r.execCommand("goCharRight"))})}function o(n,i){var r=n.getRange(t(i.line,i.ch-1),t(i.line,i.ch+1));return r.length==2?r:null}function v(n,i){var r=n.getTokenAt(t(i.line,i.ch+1));return/\bstring/.test(r.type)&&r.start==i.ch&&(i.ch==0||!/\bstring/.test(n.getTokenTypeAt(i)))}var f={pairs:"()[]{}''\"\"",closeBefore:")]}'\":;>",triples:"",explode:"[]{}"},t=n.Pos,r;n.defineOption("autoCloseBrackets",!1,function(t,u,f){f&&f!=n.Init&&(t.removeKeyMap(r),t.state.closeBrackets=null);u&&(e(i(u,"pairs")),t.state.closeBrackets=u,t.addKeyMap(r))});r={Backspace:h,Enter:c};e(f.pairs+"`")});