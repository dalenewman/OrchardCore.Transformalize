(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)})(function(n){function r(n){return n&&n.bracketRegex||/[(){}[\]]/}function u(n,u,e){var c=n.getLineHandle(u.line),o=u.ch-1,a=e&&e.afterCursor,v,l,h,y,s;return(a==null&&(a=/(^| )cm-fat-cursor($| )/.test(n.getWrapperElement().className)),v=r(e),l=!a&&o>=0&&v.test(c.text.charAt(o))&&i[c.text.charAt(o)]||v.test(c.text.charAt(o+1))&&i[c.text.charAt(++o)],!l)?null:(h=l.charAt(1)==">"?1:-1,e&&e.strict&&h>0!=(o==u.ch))?null:(y=n.getTokenTypeAt(t(u.line,o+1)),s=f(n,t(u.line,o+(h>0?1:0)),h,y||null,e),s==null)?null:{from:t(u.line,o),to:s&&s.pos,match:s&&s.ch==l.charAt(0),forward:h>0}}function f(n,u,f,e,o){for(var c,h,p,l,v,w=o&&o.maxScanLineLength||1e4,y=o&&o.maxScanLines||1e3,a=[],b=r(o),k=f>0?Math.min(u.line+y,n.lastLine()+1):Math.max(n.firstLine()-1,u.line-y),s=u.line;s!=k;s+=f)if((c=n.getLine(s),c)&&(h=f>0?0:c.length-1,p=f>0?c.length:-1,!(c.length>w)))for(s==u.line&&(h=u.ch-(f<0?1:0));h!=p;h+=f)if(l=c.charAt(h),b.test(l)&&(e===undefined||n.getTokenTypeAt(t(s,h+1))==e))if(v=i[l],v&&v.charAt(1)==">"==f>0)a.push(l);else if(a.length)a.pop();else return{pos:t(s,h),ch:l};return s-f==(f>0?n.lastLine():n.firstLine())?!1:null}function e(n,i,r){for(var f,c,l,a=n.state.matchBrackets.maxHighlightLineLength||1e3,e=[],h=n.listSelections(),o=0;o<h.length;o++)f=h[o].empty()&&u(n,h[o].head,r),f&&n.getLine(f.from.line).length<=a&&(c=f.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket",e.push(n.markText(f.from,t(f.from.line,f.from.ch+1),{className:c})),f.to&&n.getLine(f.to.line).length<=a&&e.push(n.markText(f.to,t(f.to.line,f.to.ch+1),{className:c})));if(e.length)if(s&&n.state.focused&&n.focus(),l=function(){n.operation(function(){for(var n=0;n<e.length;n++)e[n].clear()})},i)setTimeout(l,800);else return l}function o(n){n.operation(function(){n.state.matchBrackets.currentlyHighlighted&&(n.state.matchBrackets.currentlyHighlighted(),n.state.matchBrackets.currentlyHighlighted=null);n.state.matchBrackets.currentlyHighlighted=e(n,!1,n.state.matchBrackets)})}var s=/MSIE \d/.test(navigator.userAgent)&&(document.documentMode==null||document.documentMode<8),t=n.Pos,i={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<","<":">>",">":"<<"};n.defineOption("matchBrackets",!1,function(t,i,r){if(r&&r!=n.Init&&(t.off("cursorActivity",o),t.state.matchBrackets&&t.state.matchBrackets.currentlyHighlighted&&(t.state.matchBrackets.currentlyHighlighted(),t.state.matchBrackets.currentlyHighlighted=null)),i){t.state.matchBrackets=typeof i=="object"?i:{};t.on("cursorActivity",o)}});n.defineExtension("matchBrackets",function(){e(this,!0)});n.defineExtension("findMatchingBracket",function(n,t,i){return(i||typeof t=="boolean")&&(i?(i.strict=t,t=i):t=t?{strict:!0}:null),u(this,n,t)});n.defineExtension("scanForBracket",function(n,t,i,r){return f(this,n,t,i,r)})});