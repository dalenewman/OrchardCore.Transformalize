(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror"),require("../../mode/sql/sql")):typeof define=="function"&&define.amd?define(["../../lib/codemirror","../../mode/sql/sql"],n):n(CodeMirror)})(function(n){"use strict";function h(n){return Object.prototype.toString.call(n)=="[object Array]"}function b(t){var i=t.doc.modeOption;return i==="sql"&&(i="text/x-sql"),n.resolveMode(i).keywords}function k(t){var i=t.doc.modeOption;return i==="sql"&&(i="text/x-sql"),n.resolveMode(i).identifierQuote||"`"}function e(n){return typeof n=="string"?n:n.text}function v(n,t){return h(t)&&(t={columns:t}),t.text||(t.text=n),t}function d(n){var u={},t,i,r;if(h(n))for(t=n.length-1;t>=0;t--)i=n[t],u[e(i).toUpperCase()]=v(e(i),i);else if(n)for(r in n)u[r.toUpperCase()]=v(r,n[r]);return u}function o(n){return f[n.toUpperCase()]}function y(n){var i={};for(var t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return i}function p(n,t){var i=n.length,r=e(t).substr(0,i);return n.toUpperCase()===r.toUpperCase()}function u(n,t,i,r){var f,e,u;if(h(i))for(f=0;f<i.length;f++)p(t,i[f])&&n.push(r(i[f]));else for(e in i)i.hasOwnProperty(e)&&(u=i[e],u=u&&u!==!0?u.displayText?{text:u.text,displayText:u.displayText}:u.text:e,p(t,u)&&n.push(r(u)))}function g(n){var i,r;for(n.charAt(0)=="."&&(n=n.substr(1)),i=n.split(t+t),r=0;r<i.length;r++)i[r]=i[r].replace(new RegExp(t,"g"),"");return i.join(t)}function c(n){for(var u,i=e(n).split("."),r=0;r<i.length;r++)i[r]=t+i[r].replace(new RegExp(t,"g"),t+t)+t;return(u=i.join("."),typeof n=="string")?u:(n=y(n),n.text=u,n)}function nt(n,e,s,h){for(var v=!1,b=[],d=e.start,k=!0,p,tt,a;k;)k=e.string.charAt(0)==".",v=v||e.string.charAt(0)==t,d=e.start,b.unshift(g(e.string)),e=h.getTokenAt(r(n.line,e.start)),e.string=="."&&(k=!0,e=h.getTokenAt(r(n.line,e.start)));p=b.join(".");u(s,p,f,function(n){return v?c(n):n});u(s,p,i,function(n){return v?c(n):n});p=b.pop();var l=b.join("."),nt=!1,it=l;return o(l)||(tt=l,l=w(l,h),l!==tt&&(nt=!0)),a=o(l),a&&a.columns&&(a=a.columns),a&&u(s,p,a,function(n){var t=l;return nt==!0&&(t=it),typeof n=="string"?n=t+"."+n:(n=y(n),n.text=t+"."+n.text),v?c(n):n}),d}function tt(n,t){for(var r=n.split(/\s+/),i=0;i<r.length;i++)r[i]&&t(r[i].replace(/[,;]/g,""))}function w(n,t){for(var c=t.doc,w=c.getValue(),k=n.toUpperCase(),l="",v="",u=[],e={start:r(0,0),end:r(t.lastLine(),t.getLineHandle(t.lastLine()).length)},h=w.indexOf(s.QUERY_DIV),f,y,p,i,b;h!=-1;)u.push(c.posFromIndex(h)),h=w.indexOf(s.QUERY_DIV,h+1);for(u.unshift(r(0,0)),u.push(r(t.lastLine(),t.getLineHandle(t.lastLine()).text.length)),f=null,y=t.getCursor(),i=0;i<u.length;i++){if((f==null||a(y,f)>0)&&a(y,u[i])<=0){e={start:f,end:u[i]};break}f=u[i]}if(e.start)for(p=c.getRange(e.start,e.end,!1),i=0;i<p.length;i++)if(b=p[i],tt(b,function(n){var t=n.toUpperCase();t===k&&o(l)&&(v=l);t!==s.ALIAS_KEYWORD&&(l=n)}),v)break;return v}var f,i,l,t,s={QUERY_DIV:";",ALIAS_KEYWORD:"AS"},r=n.Pos,a=n.cmpPos;n.registerHelper("hint","sql",function(n,e){var a,tt,p;f=d(e&&e.tables);a=e&&e.defaultTable;tt=e&&e.disableKeywords;i=a&&o(a);l=b(n);t=k(n);a&&!i&&(i=w(a,n));i=i||[];i.columns&&(i=i.columns);var h=n.getCursor(),v=[],s=n.getTokenAt(h),y,g,c;return s.end>h.ch&&(s.end=h.ch,s.string=s.string.slice(0,h.ch-s.start)),s.string.match(/^[.`"\w@]\w*$/)?(c=s.string,y=s.start,g=s.end):(y=g=h.ch,c=""),c.charAt(0)=="."||c.charAt(0)==t?y=nt(h,s,v,n):(p=function(n,t){return typeof n=="object"?n.className=t:n={text:n,className:t},n},u(v,c,i,function(n){return p(n,"CodeMirror-hint-table CodeMirror-hint-default-table")}),u(v,c,f,function(n){return p(n,"CodeMirror-hint-table")}),tt||u(v,c,l,function(n){return p(n.toUpperCase(),"CodeMirror-hint-keyword")})),{list:v,from:r(h.line,y),to:r(h.line,g)}})});