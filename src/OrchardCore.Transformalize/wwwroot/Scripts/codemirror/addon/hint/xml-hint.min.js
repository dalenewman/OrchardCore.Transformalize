(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)})(function(n){"use strict";function t(n,t,i){return i?n.indexOf(t)>=0:n.lastIndexOf(t,0)==0}function r(r,u){var v=u&&u.schemaInfo,k=u&&u.quoteChar||'"',d=u&&u.matchInMiddle,o,f,s,c,it,w,ft,a,nt,et,y,ot,st,at,l,ht;if(v&&(o=r.getCursor(),f=r.getTokenAt(o),f.end>o.ch&&(f.end=o.ch,f.string=f.string.slice(0,o.ch-f.start)),s=n.innerMode(r.getMode(),f.state),s.mode.xmlCurrentTag)){var p=[],g=!1,e,tt=/\btag\b/.test(f.type)&&!/>$/.test(f.string),vt=tt&&/^\w/.test(f.string),ct;if(vt?(nt=r.getLine(o.line).slice(Math.max(0,f.start-2),f.start),c=/<\/$/.test(nt)?"close":/<$/.test(nt)?"open":null,c&&(ct=f.start-(c=="close"?2:1))):tt&&f.string=="<"?c="open":tt&&f.string=="<\/"&&(c="close"),it=s.mode.xmlCurrentTag(s.state),(tt||it)&&!c){var rt=it&&v[it.name],h=rt&&rt.attrs,b=v["!attrs"];if(!h&&!b)return;if(h){if(b){ft={};for(a in b)b.hasOwnProperty(a)&&(ft[a]=b[a]);for(a in h)h.hasOwnProperty(a)&&(ft[a]=h[a]);h=ft}}else h=b;if(f.type=="string"||f.string=="="){if(nt=r.getRange(i(o.line,Math.max(0,o.ch-60)),i(o.line,f.type=="string"?f.start:f.end)),et=nt.match(/([^\s\u00a0=<>\"\']+)=$/),!et||!h.hasOwnProperty(et[1])||!(y=h[et[1]]))return;for(typeof y=="function"&&(y=y.call(this,r)),f.type=="string"&&(e=f.string,ot=0,/['"]/.test(f.string.charAt(0))&&(k=f.string.charAt(0),e=f.string.slice(1),ot++),st=f.string.length,/['"]/.test(f.string.charAt(st-1))&&(k=f.string.charAt(st-1),e=f.string.substr(ot,st-2)),ot&&(at=r.getLine(o.line),at.length>f.end&&at.charAt(f.end)==k&&f.end++),g=!0),l=0;l<y.length;++l)(!e||t(y[l],e,d))&&p.push(k+y[l]+k)}else{f.type=="attribute"&&(e=f.string,g=!0);for(ht in h)h.hasOwnProperty(ht)&&(!e||t(ht,e,d))&&p.push(ht)}}else{vt&&(e=f.string);g=c;var lt=s.mode.xmlCurrentContext?s.mode.xmlCurrentContext(s.state):[],s=lt.length&&lt[lt.length-1],rt=s&&v[s],ut=s?rt&&rt.children:v["!top"];if(ut&&c!="close")for(l=0;l<ut.length;++l)(!e||t(ut[l],e,d))&&p.push("<"+ut[l]);else if(c!="close")for(w in v)v.hasOwnProperty(w)&&w!="!top"&&w!="!attrs"&&(!e||t(w,e,d))&&p.push("<"+w);s&&(!e||c=="close"&&t(s,e,d))&&p.push("<\/"+s+">")}return{list:p,from:g?i(o.line,ct==null?f.start:ct):o,to:g?i(o.line,f.end):o}}}var i=n.Pos;n.registerHelper("hint","xml",r)});