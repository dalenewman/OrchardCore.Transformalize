(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)})(function(n){"use strict";function s(n,t){return n.line-t.line||n.ch-t.ch}function i(n,t,i,r){this.line=t;this.ch=i;this.cm=n;this.text=n.getLine(t);this.min=r?Math.max(r.from,n.firstLine()):n.firstLine();this.max=r?Math.min(r.to-1,n.lastLine()):n.lastLine()}function u(n,i){var r=n.cm.getTokenTypeAt(t(n.line,i));return r&&/\btag\b/.test(r)}function c(n){if(!(n.line>=n.max))return n.ch=0,n.text=n.cm.getLine(++n.line),!0}function l(n){if(!(n.line<=n.min))return n.text=n.cm.getLine(--n.line),n.ch=n.text.length,!0}function e(n){for(var t,i,r;;){if(t=n.text.indexOf(">",n.ch),t==-1)if(c(n))continue;else return;if(!u(n,t+1)){n.ch=t+1;continue}return i=n.text.lastIndexOf("/",t),r=i>-1&&!/\S/.test(n.text.slice(i+1,t)),n.ch=t+1,r?"selfClose":"regular"}}function o(n){for(var t,i;;){if(t=n.ch?n.text.lastIndexOf("<",n.ch-1):-1,t==-1)if(l(n))continue;else return;if(!u(n,t+1)){n.ch=t;continue}if(r.lastIndex=t,n.ch=t,i=r.exec(n.text),i&&i.index==t)return i}}function a(n){for(;;){r.lastIndex=n.ch;var t=r.exec(n.text);if(!t)if(c(n))continue;else return;if(!u(n,t.index+1)){n.ch=t.index+1;continue}return n.ch=t.index+t[0].length,t}}function p(n){for(var t,i,r;;){if(t=n.ch?n.text.lastIndexOf(">",n.ch-1):-1,t==-1)if(l(n))continue;else return;if(!u(n,t+1)){n.ch=t;continue}return i=n.text.lastIndexOf("/",t),r=i>-1&&!/\S/.test(n.text.slice(i+1,t)),n.ch=t+1,r?"selfClose":"regular"}}function f(n,i){for(var f=[],u;;){var r=a(n),o,s=n.line,h=n.ch-(r?r[0].length:0);if(!r||!(o=e(n)))return;if(o!="selfClose")if(r[1]){for(u=f.length-1;u>=0;--u)if(f[u]==r[2]){f.length=u;break}if(u<0&&(!i||i==r[2]))return{tag:r[2],from:t(s,h),to:t(n.line,n.ch)}}else f.push(r[2])}}function v(n,i){for(var f=[],e,u;;){if(e=p(n),!e)return;if(e=="selfClose"){o(n);continue}var s=n.line,h=n.ch,r=o(n);if(!r)return;if(r[1])f.push(r[2]);else{for(u=f.length-1;u>=0;--u)if(f[u]==r[2]){f.length=u;break}if(u<0&&(!i||i==r[2]))return{tag:r[2],from:t(n.line,n.ch),to:t(s,h)}}}}var t=n.Pos,h="A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",y=h+"-:.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040",r=new RegExp("<(/?)(["+h+"]["+y+"]*)","g");n.registerHelper("fold","xml",function(n,r){for(var u=new i(n,r.line,0),o,c,l,h;;){if(o=a(u),!o||u.line!=r.line)return;if(c=e(u),!c)return;if(!o[1]&&c!="selfClose")return l=t(u.line,u.ch),h=f(u,o[2]),h&&s(h.from,l)>0?{from:l,to:h.from}:null}});n.findMatchingTag=function(n,r,u){var h=new i(n,r.line,r.ch,u),a;if(h.text.indexOf(">")!=-1||h.text.indexOf("<")!=-1){var l=e(h),y=l&&t(h.line,h.ch),c=l&&o(h);if(l&&c&&!(s(h,r)>0))return(a={from:t(h.line,h.ch),to:y,tag:c[2]},l=="selfClose")?{open:a,close:null,at:"open"}:c[1]?{open:v(h,c[2]),close:a,at:"close"}:(h=new i(n,y.line,y.ch,u),{open:a,close:f(h,c[2]),at:"open"})}};n.findEnclosingTag=function(n,t,r,u){for(var h=new i(n,t.line,t.ch,r),e,s,o;;){if(e=v(h,u),!e)break;if(s=new i(n,t.line,t.ch,r),o=f(s,e.tag),o)return{open:e,close:o}}};n.scanForClosingTag=function(n,t,r,u){var e=new i(n,t.line,t.ch,u?{from:0,to:u}:null);return f(e,r)}});