(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror"),require("./foldcode")):typeof define=="function"&&define.amd?define(["../../lib/codemirror","./foldcode"],n):n(CodeMirror)})(function(n){"use strict";function l(n){this.options=n;this.from=this.to=0}function a(n){return n===!0&&(n={}),n.gutter==null&&(n.gutter="CodeMirror-foldgutter"),n.indicatorOpen==null&&(n.indicatorOpen="CodeMirror-foldgutter-open"),n.indicatorFolded==null&&(n.indicatorFolded="CodeMirror-foldgutter-folded"),n}function e(n,i){for(var f,u=n.findMarks(t(i,0),t(i+1,0)),r=0;r<u.length;++r)if(u[r].__isFold&&(f=u[r].find(-1),f&&f.line===i))return u[r]}function o(n){if(typeof n=="string"){var t=document.createElement("div");return t.className=n+" CodeMirror-guttermarker-subtle",t}return n.cloneNode(!0)}function i(n,i,r){var u=n.state.foldGutter.options,f=i-1,a=n.foldOption(u,"minFoldSize"),h=n.foldOption(u,"rangeFinder"),c=typeof u.indicatorFolded=="string"&&s(u.indicatorFolded),l=typeof u.indicatorOpen=="string"&&s(u.indicatorOpen);n.eachLine(i,r,function(i){var s,r,y,v;if(++f,s=null,r=i.gutterMarkers,r&&(r=r[u.gutter]),e(n,f)){if(c&&r&&c.test(r.className))return;s=o(u.indicatorFolded)}else if(y=t(f,0),v=h&&h(n,y),v&&v.to.line-v.from.line>=a){if(l&&r&&l.test(r.className))return;s=o(u.indicatorOpen)}(s||r)&&n.setGutterMarker(i,u.gutter,s)})}function s(n){return new RegExp("(^|\\s)"+n+"(?:$|\\s)\\s*")}function f(n){var t=n.getViewport(),r=n.state.foldGutter;r&&(n.operation(function(){i(n,t.from,t.to)}),r.from=t.from,r.to=t.to)}function h(n,i,r){var o=n.state.foldGutter,u,f;o&&(u=o.options,r==u.gutter)&&(f=e(n,i),f?f.clear():n.foldCode(t(i,0),u))}function r(n){var t=n.state.foldGutter,i;t&&(i=t.options,t.from=t.to=0,clearTimeout(t.changeUpdate),t.changeUpdate=setTimeout(function(){f(n)},i.foldOnChangeTimeSpan||600))}function c(n){var t=n.state.foldGutter,r;t&&(r=t.options,clearTimeout(t.changeUpdate),t.changeUpdate=setTimeout(function(){var r=n.getViewport();t.from==t.to||r.from-t.to>20||t.from-r.to>20?f(n):n.operation(function(){r.from<t.from&&(i(n,r.from,t.from),t.from=r.from);r.to>t.to&&(i(n,t.to,r.to),t.to=r.to)})},r.updateViewportTimeSpan||400))}function u(n,t){var u=n.state.foldGutter,r;u&&(r=t.line,r>=u.from&&r<u.to&&i(n,r,r+1))}n.defineOption("foldGutter",!1,function(t,i,e){if(e&&e!=n.Init&&(t.clearGutter(t.state.foldGutter.options.gutter),t.state.foldGutter=null,t.off("gutterClick",h),t.off("changes",r),t.off("viewportChange",c),t.off("fold",u),t.off("unfold",u),t.off("swapDoc",r)),i){t.state.foldGutter=new l(a(i));f(t);t.on("gutterClick",h);t.on("changes",r);t.on("viewportChange",c);t.on("fold",u);t.on("unfold",u);t.on("swapDoc",r)}});var t=n.Pos});