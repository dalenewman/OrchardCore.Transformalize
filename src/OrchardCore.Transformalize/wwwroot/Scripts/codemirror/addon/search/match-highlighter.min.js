(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror"),require("./matchesonscrollbar")):typeof define=="function"&&define.amd?define(["../../lib/codemirror","./matchesonscrollbar"],n):n(CodeMirror)})(function(n){"use strict";function s(n){this.options={};for(var i in t)this.options[i]=(n&&n.hasOwnProperty(i)?n:t)[i];this.overlay=this.timeout=null;this.matchesonscroll=null;this.active=!1}function i(n){var t=n.state.matchHighlighter;(t.active||n.hasFocus())&&u(n,t)}function r(n){var t=n.state.matchHighlighter;t.active||(t.active=!0,u(n,t))}function u(n,t){clearTimeout(t.timeout);t.timeout=setTimeout(function(){o(n)},t.options.delay)}function f(n,t,i,r){var u=n.state.matchHighlighter,f;n.addOverlay(u.overlay=l(t,i,r));u.options.annotateScrollbar&&n.showMatchesOnScrollbar&&(f=i?new RegExp("\\b"+t.replace(/[\\\[.+*?(){|^$]/g,"\\$&")+"\\b"):t,u.matchesonscroll=n.showMatchesOnScrollbar(f,!1,{className:"CodeMirror-selection-highlight-scrollbar"}))}function e(n){var t=n.state.matchHighlighter;t.overlay&&(n.removeOverlay(t.overlay),t.overlay=null,t.matchesonscroll&&(t.matchesonscroll.clear(),t.matchesonscroll=null))}function o(n){n.operation(function(){var t=n.state.matchHighlighter,s,c,u;if(e(n),!n.somethingSelected()&&t.options.showToken){for(var l=t.options.showToken===!0?/[\w$]/:t.options.showToken,a=n.getCursor(),o=n.getLine(a.line),i=a.ch,r=i;i&&l.test(o.charAt(i-1));)--i;while(r<o.length&&l.test(o.charAt(r)))++r;i<r&&f(n,o.slice(i,r),l,t.options.style);return}(s=n.getCursor("from"),c=n.getCursor("to"),s.line==c.line)&&(!t.options.wordsOnly||h(n,s,c))&&(u=n.getRange(s,c),t.options.trim&&(u=u.replace(/^\s+|\s+$/g,"")),u.length>=t.options.minChars&&f(n,u,!1,t.options.style))})}function h(n,t,i){var f=n.getRange(t,i),r,u;return f.match(/^\w+$/)!==null?t.ch>0&&(r={line:t.line,ch:t.ch-1},u=n.getRange(r,t),u.match(/\W/)===null)?!1:i.ch<n.getLine(t.line).length&&(r={line:i.line,ch:i.ch+1},u=n.getRange(i,r),u.match(/\W/)===null)?!1:!0:!1}function c(n,t){return(!n.start||!t.test(n.string.charAt(n.start-1)))&&(n.pos==n.string.length||!t.test(n.string.charAt(n.pos)))}function l(n,t,i){return{token:function(r){if(r.match(n)&&(!t||c(r,t)))return i;r.next();r.skipTo(n.charAt(0))||r.skipToEnd()}}}var t={style:"matchhighlight",minChars:2,delay:100,wordsOnly:!1,annotateScrollbar:!1,showToken:!1,trim:!0};n.defineOption("highlightSelectionMatches",!1,function(t,u,f){if(f&&f!=n.Init&&(e(t),clearTimeout(t.state.matchHighlighter.timeout),t.state.matchHighlighter=null,t.off("cursorActivity",i),t.off("focus",r)),u){var h=t.state.matchHighlighter=new s(u);if(t.hasFocus())h.active=!0,o(t);else t.on("focus",r);t.on("cursorActivity",i)}})});