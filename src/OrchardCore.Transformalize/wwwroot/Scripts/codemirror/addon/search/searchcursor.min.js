(function(n){typeof exports=="object"&&typeof module=="object"?n(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],n):n(CodeMirror)})(function(n){"use strict";function l(n){var t=n.flags;return t!=null?t:(n.ignoreCase?"i":"")+(n.global?"g":"")+(n.multiline?"m":"")}function r(n,t){for(var u=l(n),i=u,r=0;r<t.length;r++)i.indexOf(t.charAt(r))==-1&&(i+=t.charAt(r));return u==i?n:new RegExp(n.source,i)}function o(n){return/\\s|\\n|\n|\\W|\\D|\[\^/.test(n.source)}function s(n,i,u){var s,f;i=r(i,"g");for(var e=u.line,o=u.ch,h=n.lastLine();e<=h;e++,o=0)if(i.lastIndex=o,s=n.getLine(e),f=i.exec(s),f)return{from:t(e,f.index),to:t(e,f.index+f[0].length),match:f}}function a(n,i,u){var f,c,l,a,v,y,e;if(!o(i))return s(n,i,u);for(i=r(i,"gm"),c=1,l=u.line,a=n.lastLine();l<=a;){for(v=0;v<c;v++){if(l>a)break;y=n.getLine(l++);f=f==null?y:f+"\n"+y}if(c=c*2,i.lastIndex=u.ch,e=i.exec(f),e){var p=f.slice(0,e.index).split("\n"),h=e[0].split("\n"),w=u.line+p.length-1,b=p[p.length-1].length;return{from:t(w,b),to:t(w+h.length-1,h.length==1?b+h[0].length:h[h.length-1].length),match:e}}}}function h(n,t,i){for(var u,f=0,r,e;f<=n.length;){if(t.lastIndex=f,r=t.exec(n),!r)break;if(e=r.index+r[0].length,e>n.length-i)break;(!u||e>u.index+u[0].length)&&(u=r);f=r.index+1}return u}function c(n,i,u){var s,f;i=r(i,"g");for(var e=u.line,o=u.ch,c=n.firstLine();e>=c;e--,o=-1)if(s=n.getLine(e),f=h(s,i,o<0?0:s.length-o),f)return{from:t(e,f.index),to:t(e,f.index+f[0].length),match:f}}function v(n,i,u){var f,a,b,e,v,y,p,s;if(!o(i))return c(n,i,u);for(i=r(i,"gm"),a=1,b=n.getLine(u.line).length-u.ch,e=u.line,v=n.firstLine();e>=v;){for(y=0;y<a&&e>=v;y++)p=n.getLine(e--),f=f==null?p:p+"\n"+f;if(a*=2,s=h(f,i,b),s){var w=f.slice(0,s.index).split("\n"),l=s[0].split("\n"),k=e+w.length,d=w[w.length-1].length;return{from:t(k,d),to:t(k+l.length-1,l.length==1?d+l[0].length:l[l.length-1].length),match:s}}}}function i(n,t,i,r){var u,e,f,o;if(n.length==t.length)return i;for(u=0,e=i+Math.max(0,n.length-t.length);;){if(u==e)return u;if(f=u+e>>1,o=r(n.slice(0,f)).length,o==i)return f;o>i?e=f:u=f+1}}function y(n,r,e,o){var h,s,v,l,y,e,w,p;if(!r.length)return null;h=o?u:f;s=h(r).split(/\r|\n\r?/);n:for(var c=e.line,a=e.ch,g=n.lastLine()+1-s.length;c<=g;c++,a=0){if(v=n.getLine(c).slice(a),l=h(v),s.length==1){if(y=l.indexOf(s[0]),y==-1)continue n;return e=i(v,l,y,h)+a,{from:t(c,i(v,l,y,h)+a),to:t(c,i(v,l,y+s[0].length,h)+a)}}if(w=l.length-s[0].length,l.slice(w)==s[0]){for(p=1;p<s.length-1;p++)if(h(n.getLine(c+p))!=s[p])continue n;var k=n.getLine(c+s.length-1),d=h(k),b=s[s.length-1];if(d.slice(0,b.length)==b)return{from:t(c,i(v,l,w,h)+a),to:t(c+s.length-1,i(k,d,b.length,h))}}}}function p(n,r,e,o){var h,s,l,a,y,p,v,e,w,b;if(!r.length)return null;h=o?u:f;s=h(r).split(/\r|\n\r?/);n:for(var c=e.line,k=e.ch,d=n.firstLine()-1+s.length;c>=d;c--,k=-1){if(l=n.getLine(c),k>-1&&(l=l.slice(0,k)),a=h(l),s.length==1){if(y=a.lastIndexOf(s[0]),y==-1)continue n;return{from:t(c,i(l,a,y,h)),to:t(c,i(l,a,y+s[0].length,h))}}if(p=s[s.length-1],a.slice(0,p.length)==p){for(v=1,e=c-s.length+1;v<s.length-1;v++)if(h(n.getLine(e+v))!=s[v])continue n;if(w=n.getLine(c+1-s.length),b=h(w),b.slice(b.length-s[0].length)==s[0])return{from:t(c+1-s.length,i(w,b,w.length-s[0].length,h)),to:t(c,i(l,a,p.length,h))}}}}function e(n,i,u,f){this.atOccurrence=!1;this.doc=n;u=u?n.clipPos(u):t(0,0);this.pos={from:u,to:u};var e;typeof f=="object"?e=f.caseFold:(e=f,f=null);typeof i=="string"?(e==null&&(e=!1),this.matches=function(t,r){return(t?p:y)(n,i,r,e)}):(i=r(i,"gm"),this.matches=f&&f.multiline===!1?function(t,r){return(t?c:s)(n,i,r)}:function(t,r){return(t?v:a)(n,i,r)})}var t=n.Pos,u,f;String.prototype.normalize?(u=function(n){return n.normalize("NFD").toLowerCase()},f=function(n){return n.normalize("NFD")}):(u=function(n){return n.toLowerCase()},f=function(n){return n});e.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(i){for(var r=this.matches(i,this.doc.clipPos(i?this.pos.from:this.pos.to)),u;r&&n.cmpPos(r.from,r.to)==0;)i?r.from.ch?r.from=t(r.from.line,r.from.ch-1):r=r.from.line==this.doc.firstLine()?null:this.matches(i,this.doc.clipPos(t(r.from.line-1))):r.to.ch<this.doc.getLine(r.to.line).length?r.to=t(r.to.line,r.to.ch+1):r=r.to.line==this.doc.lastLine()?null:this.matches(i,t(r.to.line+1,0));return r?(this.pos=r,this.atOccurrence=!0,this.pos.match||!0):(u=t(i?this.doc.firstLine():this.doc.lastLine()+1,0),this.pos={from:u,to:u},this.atOccurrence=!1)},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(i,r){if(this.atOccurrence){var u=n.splitLines(i);this.doc.replaceRange(u,this.pos.from,this.pos.to,r);this.pos.to=t(this.pos.from.line+u.length-1,u[u.length-1].length+(u.length==1?this.pos.from.ch:0))}}};n.defineExtension("getSearchCursor",function(n,t,i){return new e(this.doc,n,t,i)});n.defineDocExtension("getSearchCursor",function(n,t,i){return new e(this,n,t,i)});n.defineExtension("selectMatches",function(t,i){for(var u=[],r=this.getSearchCursor(t,this.getCursor("from"),i);r.findNext();){if(n.cmpPos(r.to(),this.getCursor("to"))>0)break;u.push({anchor:r.from(),head:r.to()})}u.length&&this.setSelections(u,0)})});